---
title: "01. Chapter5 - Interspecific variation in enzyme thermal performance curves"
author: "Elliott Schmidt"
date: "10 May, 2024"
output:
  html_document:
    keep_md: yes
    code_folding: show
    collapse: no
    df_print: paged
    fig_caption: yes
    fig_height: 4
    fig_width: 6
    highlight: monochrome
    theme: cerulean
    latex_engine: xelatex
    toc: yes
    toc_float: yes
    css: styles.css
  pdf_document:
    df_print: default
    fig_caption: yes
    fig_height: 4
    fig_width: 4
    highlight: tango
    latex_engine: xelatex
    number_sections: yes
    toc_depth: 2
documentclass: article
fontsize: 12pt
mainfont: Arial
mathfont: LiberationMono
classoption: a4paper
---

# Scenario 

Understanding thermal perfomance curves of anaerobic and aerobic enzymes for species can help identify differences in thermal tolerance among difference species. In this study four different species including, _Apogon rubrimacula_, _Apogon doederlein_, _Pomeacentrus australia_, and _Pomacentrus moluccensis_ had white muscle tissue samples collected, and used to determine thermal performance curves of two enzymes - lactate dehydrogenase (LDH) and citrate synthase (CS). Each enzyme was tested over five different temperatures including, 10$^\circ$C, 20$^\circ$C, 30$^\circ$C, 40$^\circ$C, and 50$^\circ$C, to create a thermal performance curve. Specie in this study consisted for two cardinal fish species and two damselfish species, with different levels of reliance on coral reef structures. Results from this study will help determine thermal tolerance levels of nultiple reef species to help understand how different species may respond differently to changing environmental conditions. 

# Load packages 


```r
library(tidyverse) # data manipulation
library(janitor) # data manipulation
library(chron) # data manipulation - time data
library(lubridate) # data manipulation - specifically time data
library(ggplot2) # plotting figures
library(glmmTMB) # running models
library(performance) # model validation
library(car) # dependent
library(DHARMa) # model validation
library(MuMIn) # model validation
library(kableExtra) # creating tables
library(broom) # dependent
library(emmeans) # post-hoc analysis
library(ggeffects) # plotting models/model validation
library(vtable) # creating tables
library(modelr) # model validation
library(kableExtra) # formatting output tables
library(sjPlot) # plotting models & saving images as .svg
library(ggpmisc) # plotting linear equations on figures 
library(ggpubr) # combining multiple plots
```

# Lactate dehydrogenase (LDH)

## Read in the data




```r
knitr::opts_knit$set(root.dir=working.dir)
```

## Load data 



```r
ldh <- import.data
tissue.mass <- import.data2
fish_mass <- import.data3
```

## Data manipulation 


```r
#--- data preparation/manipulation ---# 
ldh2 <- ldh |>
  clean_names() |>
  separate(sample, into=c('tissue_type','species','replicate','temperature'), sep = "_", remove = FALSE) |> 
  mutate(creation_time = dmy_hm(creation_time)) |>
  separate(creation_time, into=c('DATE','TIME'), sep = " ", remove = FALSE) |>
  arrange(sample_id_1, DATE, TIME) 

ldh3 <- ldh2 |> 
  mutate(TIME = hms(ldh2$TIME)) |>
  mutate(TIME = chron(times=ldh2$TIME)) |>
  arrange(TIME) |>
  dplyr::group_by(sample, sample_id_1) |> 
  dplyr::mutate(TIME_DIFF = TIME - first(TIME)) |> 
  dplyr::filter(TIME != first(TIME)) |>
  dplyr::ungroup() |> 
  mutate(TIME_DIFF_SECS = period_to_seconds(hms(TIME_DIFF))) |> 
  mutate(MINUTES = TIME_DIFF_SECS/60) |> 
  mutate(MINUTES = round(MINUTES, digits = 2)) |> 
  dplyr::rename(CUVETTE = sample_id_1) |> 
  mutate(LATIN_NAME = case_when( species =="Adoed"~ "Apogon doederlein", 
                             species == "Arub" ~ "Apogon rubrimacula", 
                             species == "Paus" ~ "Pomacentrus australis",
                             species == "Pmol" ~ "Pomacentrus moluccensis",
                             TRUE ~ "na")) |> 
  unite("UNIQUE_SAMPLE_ID", c(species, replicate, temperature, sample_index), sep="_", remove = FALSE)
```

### Data cleaning 

Next select data points will be removed. Data points have been checked using previously written app script that allows the user to look at the plotted points of samples that were run. Because we are interested in the slope, points that plateaued were removed from the analysis, as it signifies that the reaction ran out of 'fuel' to use.

* **grp1**: removed last data point which was causing a plateau
* **grp2**: removed last 2 data points which was causing a plateau
* **grp3**: removed last 3 data points which was causing a plateau
* **grp4**: removed last 4 data points which was causing a plateau
* **grp5**: removed last 5 data points which was causing a plateau


```r
grp1 <- c() 
grp2 <- c("Paus_07_50_1","Paus_07_50_2","Paus_07_50_3","Paus_08_50_1","Paus_08_50_2","Paus_08_50_3", 
          "Pmol_06_50_1","Pmol_06_50_2","Pmol_06_50_3", "Pmol_08_50_1","Pmol_08_50_2","Pmol_08_50_3", 
          "Pmol_09_50_1","Pmol_09_50_2","Pmol_09_50_3")
grp3 <- c() 
grp4 <- c("Adoed_05_50_1","Adoed_05_50_2","Adoed_05_50_3", "Adoed_09_50_1","Adoed_09_50_2","Adoed_09_50_3") 
grp5 <- c("Arub_08_50_1","Arub_08_50_2","Arub_08_50_3", "Arub_07_50_1","Arub_07_50_2","Arub_07_50_3", 
          "Adoed_04_50_1","Adoed_04_50_2","Adoed_04_50_3", "Adoed_06_50_1","Adoed_06_50_2","Adoed_06_50_3", 
          "Adoed_07_50_1","Adoed_07_50_2","Adoed_07_50_3", "Adoed_08_50_1","Adoed_08_50_2","Adoed_08_50_3", 
          "Adoed_10_50_1","Adoed_10_50_2","Adoed_10_50_3", "Pmol_01_50_1","Pmol_01_50_2","Pmol_01_50_3")  
grp6 <- c() 
grp7 <- c() 
grp8 <- c("Adoed_02_50_1","Adoed_02_50_2","Adoed_02_50_3") 
```



```r
ldh3.filtered <- ldh3 |> 
  filter(!(UNIQUE_SAMPLE_ID %in% c("Arub_08_30_2", "Arub_06_40_2", "Arub_04_10_1", "Arub_02_40_2", 
                                   "Adoed_03_30_2", "Adoed_04_40_1", "Adoed_08_30_2", 
                                   "Paus_10_20_2", 
                                   "Pmol_03_40_3", "Pmol_04_50_3", "Pmol_05_30_2"))) |>
  dplyr::group_by(UNIQUE_SAMPLE_ID) |> 
  arrange(UNIQUE_SAMPLE_ID, TIME) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp2 & row_number() > (n() - 2))) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp4 & row_number() > (n() - 4))) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp5 & row_number() > (n() - 5))) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp8 & row_number() > (n() - 8))) |> 
  dplyr::ungroup() |> 
  mutate(UNIQUE_SAMPLE_ID = str_sub(UNIQUE_SAMPLE_ID, end = -3))
```



```r
write.table(ldh3.filtered, file = "./excel_files/LDH_Hunter_filtered.csv", col.names = TRUE, row.names = FALSE, sep=",")
write.table(ldh3.filtered, file = "./import_files/LDH_Hunter_filtered.txt", col.names = TRUE, row.names = FALSE, sep="\t")
write.table(ldh3, file = "./excel_files/LDH_Hunter_processed.csv", col.names = TRUE, row.names = FALSE, sep=",")
write.table(ldh3, file = "./import_files/LDH_Hunter_processed.txt", col.names = TRUE, row.names = FALSE, sep="\t")
```
Great! Now we have all the data points that we want to keep. However, the data needs to manipulated in a way that we can obtain and pull out slopes from the absorption readings, and the calculate enzyme activity based on these slopes. This will involve a number of steps.  

### Data calculations 

#### Step1: Extract slopes 

Step1 will produce a data frame that provides you with the slope that was obtained for cuvettes 1-3 for each sample run at each experimental temperature. Note that at the end of this step we are removing slopes that were positive in value, as LDH slopes should produce a negative slope, due to NADH being used up. 

```r
LDH_activity <- ldh3.filtered %>% 
  dplyr::group_by(UNIQUE_SAMPLE_ID, CUVETTE) %>% 
  do({
    mod = lm(result ~ MINUTES, data = .)
    data.frame(Intercept = coef(mod)[1],
               Slope = coef(mod)[2], 
               r2 = summary(mod)$adj.r.squared)
  }) %>%
  dplyr::ungroup() %>%
  filter(CUVETTE != ("6"))%>% 
  filter(CUVETTE != ("4"))%>% 
  filter(CUVETTE != ("5")) %>% 
  filter(Slope <= 0)
```

#### Step2: Slope means

Step2 will calculate the mean slope for cuvette 1-3. 

```r
LDH_activity_means <- LDH_activity %>% 
  dplyr::group_by(UNIQUE_SAMPLE_ID) %>% 
  dplyr::mutate(Mean = mean(Slope)) %>% 
  ungroup()
```

#### Step3: Background activity level

Step3 will calculate background activity level by measuring the slope from cuvette 5 (postive control)

```r
LDH_background <- ldh3 %>% 
  group_by(UNIQUE_SAMPLE_ID, CUVETTE) %>% 
  do({
    mod = lm(result ~ MINUTES, data = .)
    data.frame(Intercept = coef(mod)[1],
               Slope = coef(mod)[2])
  }) %>%
  ungroup() %>%
  filter(CUVETTE == ("5")) %>% 
  dplyr::rename(Background = Slope) %>% 
  mutate(UNIQUE_SAMPLE_ID = str_sub(UNIQUE_SAMPLE_ID, end = -3)) 
```

#### Step4: Merging dataframes

Step4 will merge the data frames that you created with the mean slopes and the background slopes.

```r
final_table <- LDH_activity %>% 
  full_join(distinct(LDH_activity_means[,c(1,6)]), by = "UNIQUE_SAMPLE_ID") %>% 
  full_join(LDH_background[,c(1,4)], by = "UNIQUE_SAMPLE_ID") 
final_table$Mean[duplicated(final_table$Mean)] <- ""
final_table$Background[duplicated(final_table$Background)] <- ""
final_table <- final_table %>% 
  mutate(Mean = as.numeric(Mean), 
         Background = as.numeric(Background), 
         Background_perc = Background/Mean) 
```

#### Step5: Enzyme activity levels 

Step5 is where enzyme activity levels are calculated. See further details in manuscript (doi: xxx). Within this step background activity level is taken into account and subtracted from slopes where background activity was >5% or more of the sample slope. 

```r
ldh.data <- final_table %>% 
  select(c(UNIQUE_SAMPLE_ID, Mean, Background, Background_perc)) %>% 
  mutate(Mean = as.numeric(Mean), 
         Background = as.numeric(Background), 
         Background_perc = as.numeric(Background_perc)) %>% 
  mutate(Background2 = case_when(Background_perc <= 0.05 ~ 0, 
                                    TRUE ~ Background), 
         LDH_ABSORBANCE = Mean - Background2) %>%
  drop_na() %>% 
  inner_join(select(ldh3.filtered, c(UNIQUE_SAMPLE_ID, species, replicate, temperature, LATIN_NAME)), by ="UNIQUE_SAMPLE_ID") %>% 
  unite("fish_id", c(species,replicate), sep = "_", remove = FALSE)%>% 
  filter(fish_id != "Paus_07") %>% # values appear to be outlier
  inner_join(tissue.mass, by = "fish_id") %>% 
  mutate(TISSUE_MASS_CENTERED = scale(tissue_mass, center = TRUE, scale = FALSE)) %>%
  distinct(UNIQUE_SAMPLE_ID, .keep_all = TRUE) %>% 
  mutate(PATH_LENGTH = 1, 
         EXTINCTION_COEFFICIENT = 6.22, 
         TISSUE_CONCENTRATION = 0.005, 
         ASSAY_VOL = 0.975, 
         SAMPLE_VOL = 0.025, 
         LDH_ACTIVITY = ((LDH_ABSORBANCE/(PATH_LENGTH*EXTINCTION_COEFFICIENT*TISSUE_CONCENTRATION))*(ASSAY_VOL/SAMPLE_VOL))*-1) %>% 
  mutate(species = factor(species), 
         replicate = factor(replicate), 
         temperature = as.numeric(temperature), 
         fish_id = factor(fish_id)) %>% 
  separate(LATIN_NAME, c("LATIN_GENUS","LATIN_SPECIES"), sep = " ", remove = FALSE) %>% 
  mutate(LATIN_GENUS = factor(LATIN_GENUS), 
         LATIN_SPECIES = factor(LATIN_SPECIES)) %>% 
  mutate(LATITUDE = factor(case_when(species =="Adoed"~ "sub-tropical", 
                             species == "Arub" ~ "tropical", 
                             species == "Paus" ~ "sub-tropical",
                             species == "Pmol" ~ "tropical",
                             TRUE ~ "na"))) |> 
  left_join(select(fish_mass, c("fish_id","standard_length","mass")), by="fish_id") |> 
  dplyr::rename(MASS = mass)
```

All done! Ready for data analysis 

## Initial plot {.tabset}

### LDH v TEMPERATURE [SPECIES]


```r
ggplot(ldh.data, aes(x =temperature, y= LDH_ACTIVITY, color = species)) + 
  geom_point() + geom_smooth(method = "lm", se=FALSE) + theme_classic() 
```

![](01.DataAnalysis_files/figure-html/ldh-initial-plots-1.png)<!-- -->

### LDH [distribution]

```r
ggplot(ldh.data, aes(x = LDH_ACTIVITY, fill = temperature, color = temperature)) + 
  geom_density(alpha =0.5, position = "identity") 
```

![](01.DataAnalysis_files/figure-html/ldh-initial-plots-2-1.png)<!-- -->

```r
ggplot(ldh.data, aes(x=LDH_ACTIVITY)) + geom_histogram()
```

![](01.DataAnalysis_files/figure-html/ldh-initial-plots-2-2.png)<!-- -->

### LDH v TEMPERATURE [LATITUDE]

```r
ggplot(ldh.data, aes(x =temperature, y= LDH_ACTIVITY, colour = LATITUDE, fill=LATITUDE)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 3, raw=TRUE), alpha=0.3) + facet_grid(~LATIN_GENUS) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/ldh-initial-plots-3-1.png)<!-- -->

### LDH v TEMPERATURE [GENUS]

```r
ggplot(ldh.data, aes(x =temperature, y= LDH_ACTIVITY, colour = LATIN_GENUS, fill=LATIN_GENUS)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 3, raw=TRUE), alpha=0.3) + facet_grid(~LATITUDE) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/ldh-initial-plots-4-1.png)<!-- -->

### LDH v TEMPERATURE [SPECIES]

```r
ggplot(ldh.data, aes(x =temperature, y= LDH_ACTIVITY, colour = species, fill= species)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 3, raw=TRUE), alpha=0.3) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/ldh-initial-plots-5-1.png)<!-- -->

### LDH v MASS 

```r
ggplot(ldh.data, aes(x =MASS, y= LDH_ACTIVITY, colour = species, fill= species)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE, alpha=0.3) + theme_classic() + 
  facet_wrap(~temperature)
```

![](01.DataAnalysis_files/figure-html/ldh-initial-plots-6-1.png)<!-- -->

### {-}

## Fit the model 

The model was fit using the **glm** and later **glmmTMB** package in R. A number of different models were tested to determine which hypothesis and associated variables best predicted resting oxygen consumption. Model fit was examined using AICc, BIC, and r-squared values. Additional model were examined via the validation diagnostics provided by the **performance** and **dHARMA** packages in R. 

From out initial plots we can see that our data is heavily skewed to the right. From our initial plots we can all see that the relationship between enzyme activity and temperature is no linear, but rather may represent either a quadratic or cubic relationship. Let's start out model selection process by comparing different polynomial models.  

### polynomial models

```r
#--- model 1 ---# 
ldh.model.1 <- glm(LDH_ACTIVITY ~ temperature * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = ldh.data) 

ldh.model.1.p2 <- glm(LDH_ACTIVITY ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = ldh.data)  

ldh.model.1.p3 <- glm(LDH_ACTIVITY ~ poly(temperature, 3) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = ldh.data) 
```

#### model comparisons - polynomial models 

```r
aic.c=AICc(ldh.model.1, ldh.model.1.p2, ldh.model.1.p3, k=2) 
bic=BIC(ldh.model.1, ldh.model.1.p2, ldh.model.1.p3)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredLR(ldh.model.1)[1], r.squaredLR(ldh.model.1.p2)[1], r.squaredLR(ldh.model.1.p3)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> ldh.model.1 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 1940.896 </td>
   <td style="text-align:right;"> 1968.850 </td>
   <td style="text-align:right;"> 0.7591191 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.model.1.p2 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 1737.866 </td>
   <td style="text-align:right;"> 1777.602 </td>
   <td style="text-align:right;"> 0.9234720 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.model.1.p3 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;"> 1737.674 </td>
   <td style="text-align:right;"> 1788.756 </td>
   <td style="text-align:right;"> 0.9273923 </td>
  </tr>
</tbody>
</table>

```r
anova(ldh.model.1, ldh.model.1.p2, ldh.model.1.p3, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Resid. Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Resid. Dev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"177","2":"351846.6","3":"NA","4":"NA","5":"NA","_rn_":"1"},{"1":"173","2":"111781.9","3":"4","4":"240064.694","5":"1.642823e-81","_rn_":"2"},{"1":"169","2":"106055.7","3":"4","4":"5726.227","5":"5.805562e-02","_rn_":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

Looks like the model where temperature is treated as a second order polynomial (quadratic) is better than the linear and third order polynomial model. Lets see if adding the variable **tissue.mass** improves the model. 

### fixed factor comparisons

```r
#--- model 1 ---# 
ldh.model.1.p2 <- glm(LDH_ACTIVITY ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = ldh.data)  

ldh.model.1.p2b <- ldh.model.1.p2 %>% update(. ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + scale(tissue_mass))  

ldh.model.1.p2c <- ldh.model.1.p2 %>% update(. ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + scale(MASS))

ldh.model.1.p2d <- ldh.model.1.p2 %>% update(. ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass))
```

#### model comparisons - fixed factor comparisons 

```r
aic.c=AICc(ldh.model.1.p2, ldh.model.1.p2b, ldh.model.1.p2c, ldh.model.1.p2d, k=4) 
bic=BIC(ldh.model.1.p2, ldh.model.1.p2b, ldh.model.1.p2c, ldh.model.1.p2d)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredLR(ldh.model.1.p2)[1], r.squaredLR(ldh.model.1.p2b)[1],r.squaredLR(ldh.model.1.p2c)[1],r.squaredLR(ldh.model.1.p2d)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> ldh.model.1.p2 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 1765.995 </td>
   <td style="text-align:right;"> 1777.602 </td>
   <td style="text-align:right;"> 0.9234720 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.model.1.p2b </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1770.503 </td>
   <td style="text-align:right;"> 1782.647 </td>
   <td style="text-align:right;"> 0.9235446 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.model.1.p2c </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1768.722 </td>
   <td style="text-align:right;"> 1780.865 </td>
   <td style="text-align:right;"> 0.9242774 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.model.1.p2d </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 1765.960 </td>
   <td style="text-align:right;"> 1779.009 </td>
   <td style="text-align:right;"> 0.9291470 </td>
  </tr>
</tbody>
</table>

```r
anova(ldh.model.1.p2, ldh.model.1.p2b, ldh.model.1.p2c, ldh.model.1.p2d, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Resid. Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Resid. Dev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"173","2":"111781.9","3":"NA","4":"NA","5":"NA","_rn_":"1"},{"1":"172","2":"111675.8","3":"1","4":"106.1362","5":"0.676280914","_rn_":"2"},{"1":"172","2":"110605.4","3":"0","4":"1070.3772","5":"NA","_rn_":"3"},{"1":"170","2":"103492.5","3":"2","4":"7112.8282","5":"0.002903397","_rn_":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

The variable **TISSUE_MASS_CENTERED does not** improve the model, therefore it will be left out of the model moving forward. 

Lastly, because tissue samples from the same fish were tested at multiple temperatures we need to include **fish_id** as a random factor. 

### Generalised linear mixed model (GLMM)

```r
ldh.glmm.1.p2 <- glmmTMB(LDH_ACTIVITY ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + (1|fish_id), 
               family = gaussian(),
               REML = TRUE,
               data = ldh.data) 
```

Great! Now lets check our model validations to see how the model is performing. 

## Model validation {.tabset}

### ldh.glmm.1.p2 [performance]


```r
ldh.glmm.1.p2 %>% check_model(detrend=FALSE)
```

![](01.DataAnalysis_files/figure-html/model-validatiaon-1-1.png)<!-- -->

### ldh.glmm.1.p2 [DHARMa]


```r
ldh.glmm.1.p2 %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/model-validatiaon-2-1.png)<!-- -->

```
## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.476 0.828 0.956 0.944 0.944 0.472 0.58 0.248 0.008 0 0.416 0.504 0.164 0.6 0.928 0.456 0.568 0.436 0.376 0.068 ...
```

```r
ldh.glmm.1.p2 %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/model-validatiaon-2-2.png)<!-- -->

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.12562, p-value = 0.005824
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.93488, p-value = 0.616
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 4, observations = 185, p-value = 0.06169
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.005921851 0.054432015
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                             0.02162162
```

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.12562, p-value = 0.005824
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.93488, p-value = 0.616
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 4, observations = 185, p-value = 0.06169
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.005921851 0.054432015
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                             0.02162162
```

There are a number of issues with this model. Lets see if we can solve some of the issues by exploring link functions that we have available.  

### {-}

## Re-fitting model 

Turn **REML** off when comparing models

### re-fitting models [link functions]


```r
ldh.glmm.1.p2 <- ldh.glmm.1.p2 %>% update(REML=FALSE)
```

```
## Warning in finalizeTMB(TMBStruc, obj, fit, h, data.tmb.old): Model convergence
## problem; non-positive-definite Hessian matrix. See vignette('troubleshooting')
```

```r
ldh.glmm.1.p2.log <- ldh.glmm.1.p2 %>% update(family=gaussian(link="log"), 
                                              REML=FALSE) 
ldh.glmm.1.p2.sqrt <- ldh.glmm.1.p2 %>% update(family=gaussian(link="sqrt"), 
                                               REML=FALSE) 
```

### re-fit model comparisons [link function]


```r
aic.c=AICc(ldh.model.1.p2, ldh.glmm.1.p2.log,ldh.glmm.1.p2.sqrt,  k=2) 
bic=BIC(ldh.model.1.p2, ldh.glmm.1.p2.log, ldh.glmm.1.p2.sqrt)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredGLMM(ldh.model.1.p2)[1], r.squaredGLMM(ldh.glmm.1.p2.log)[1], r.squaredGLMM(ldh.glmm.1.p2.sqrt)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> ldh.model.1.p2 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 1737.866 </td>
   <td style="text-align:right;"> 1777.602 </td>
   <td style="text-align:right;"> 0.9190002 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.glmm.1.p2.log </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1543.296 </td>
   <td style="text-align:right;"> 1585.910 </td>
   <td style="text-align:right;"> 0.0309730 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.glmm.1.p2.sqrt </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1543.046 </td>
   <td style="text-align:right;"> 1585.661 </td>
   <td style="text-align:right;"> 0.2123071 </td>
  </tr>
</tbody>
</table>

From this model comparison it looks like the model that uses the **square root** link function does the best job modelling the data. Lets see how the model validation looks. We will run the model one more time with **REML=TRUE** before looking at model validation outputs. 


```r
ldh.glmm.1.p2.sqrt <- ldh.glmm.1.p2.sqrt %>% update(REML = TRUE)
```

## Model re-validation {.tabset}

### ldh.glmm.1.p2 [performance]


```r
ldh.glmm.1.p2.sqrt %>% check_model(detrend=FALSE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-re-validatiaon-1-1.png)<!-- -->

### ldh.glmm.1.p2 [DHARMa]


```r
ldh.glmm.1.p2.sqrt %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-re-validatiaon-2-1.png)<!-- -->

```
## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.544 0.948 0.936 0.86 0.764 0.58 0.636 0.188 0.044 0.044 0.412 0.484 0.108 0.636 0.792 0.54 0.564 0.4 0.42 0.208 ...
```

```r
ldh.glmm.1.p2.sqrt %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-re-validatiaon-2-2.png)<!-- -->

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.14757, p-value = 0.0006336
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.81088, p-value = 0.432
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 185, p-value = 0.4118
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.0000000 0.0197424
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.14757, p-value = 0.0006336
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.81088, p-value = 0.432
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 185, p-value = 0.4118
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.0000000 0.0197424
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

### {-}

## Important note

**NOTE:** The sqrt gaussian model actually performs pretty well. However, when we look at the model there are clear signs of heteroscadiscity within the data (i.e., increasing variation at higher dependent variable values). This seems to be feature of the enzyme data whereby at low temperatures there is very little activity, and therefore little variation within activity at 10, 20, and 30C. However as temperatures increase to 40 and 50C we start to see enzyme activities increase exponentially and begin to identify maximal enzyme activity. Here we would _expect_ to see more variation as we are beginning to see the difference different individuals have in maximum LDH activity. One could argue in continuing to use this more despite heteroscadiscity being seen within the data. However, there are a couple of options if one chooses to fix the issue. The first could be to try a different distribution, another could be to transform that data. Both options are explored below. While these options may help, I think it is important to think about whether or not we want increase variation at higher temperatures to be something that is included within our model as it may be a _feature_ of the model rather than an unwanted _artefact_ within the data.

## Model re-re-fit 

### Gamma models

```r
ldh.glmm.1.p2.sqrt <- ldh.glmm.1.p2.sqrt %>% update(REML = FALSE)
ldh.glmm.1.p2.gamma.log <- ldh.glmm.1.p2.sqrt %>% update(family = Gamma(link="log"), 
                                                     REML = FALSE)  
ldh.glmm.1.p2.gamma.sqrt <- ldh.glmm.1.p2.sqrt %>% update(family = Gamma(link="sqrt"), 
                                                     REML = FALSE)  
```

### model comparisons - Gamma models 

```r
aic.c=AICc(ldh.glmm.1.p2.sqrt, ldh.glmm.1.p2.gamma.log,ldh.glmm.1.p2.gamma.sqrt,  k=2) 
bic=BIC(ldh.glmm.1.p2.sqrt, ldh.glmm.1.p2.gamma.log, ldh.glmm.1.p2.gamma.sqrt)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredGLMM(ldh.glmm.1.p2.sqrt)[1], r.squaredGLMM(ldh.glmm.1.p2.gamma.log)[1], "NA"))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:left;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> ldh.glmm.1.p2.sqrt </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1543.046 </td>
   <td style="text-align:right;"> 1585.661 </td>
   <td style="text-align:left;"> 0.212307132607568 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.glmm.1.p2.gamma.log </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1504.116 </td>
   <td style="text-align:right;"> 1546.730 </td>
   <td style="text-align:left;"> 0.902009164180205 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.glmm.1.p2.gamma.sqrt </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1452.150 </td>
   <td style="text-align:right;"> 1494.764 </td>
   <td style="text-align:left;"> NA </td>
  </tr>
</tbody>
</table>

## Model re-re-validation {.tabset}

### ldh.glmm.1.p2.gamma [performance]


```r
# ldh.glmm.1.p2.gamma.sqrt %>% check_model(detrend=FALSE)
```

### ldh.glmm.1.p2 [DHARMa]


```r
ldh.glmm.1.p2.gamma.sqrt %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-re-re-validatiaon-2-1.png)<!-- -->

```
## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.5 0.972 0.996 0.9 0.532 0.484 0.392 0.252 0.124 0.088 0.18 0.072 0.044 0.748 0.452 0.46 0.08 0.68 0.648 0.244 ...
```

```r
ldh.glmm.1.p2.gamma.sqrt %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-re-re-validatiaon-2-2.png)<!-- -->

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.036973, p-value = 0.9621
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.49735, p-value = 0.008
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 1, observations = 185, p-value = 1
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.0001368437 0.0297474941
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                            0.005405405
```

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.036973, p-value = 0.9621
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.49735, p-value = 0.008
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 1, observations = 185, p-value = 1
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.0001368437 0.0297474941
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                            0.005405405
```

### {-}

## Important note 2
The Gamma distribution does seem to improve the model, definitely helps solve the heteroscadisity problem, however, there are down sides. The gamma more with the square-root link doesn't seem to as good a job at handling data at the upper and lower ends of the spectrum as noted by the qq-plot in the performance package diagnostics. Also, the dispersion assumption within the DHARMa diagnositics is violated. Let's move on and see how the data transformation models perform. 

## Fit model [Transformed data]

### polynomial models [Transformed data]

```r
#--- model 1 ---# 
ldh.sqrt.model.1 <- glm(sqrt(LDH_ACTIVITY) ~ temperature * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = ldh.data) 

ldh.sqrt.model.1.p2 <- glm(sqrt(LDH_ACTIVITY) ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = ldh.data)  

ldh.sqrt.model.1.p3 <- glm(sqrt(LDH_ACTIVITY) ~ poly(temperature, 3) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = ldh.data) 
```

#### model comparisons - polynomial models 

```r
aic.c=AICc(ldh.sqrt.model.1, ldh.sqrt.model.1.p2, ldh.sqrt.model.1.p3, k=2) 
bic=BIC(ldh.sqrt.model.1, ldh.sqrt.model.1.p2, ldh.sqrt.model.1.p3)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredLR(ldh.sqrt.model.1)[1], r.squaredLR(ldh.sqrt.model.1.p2)[1], r.squaredLR(ldh.sqrt.model.1.p3)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> ldh.sqrt.model.1 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 775.5599 </td>
   <td style="text-align:right;"> 803.5146 </td>
   <td style="text-align:right;"> 0.8516987 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.sqrt.model.1.p2 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 618.7107 </td>
   <td style="text-align:right;"> 658.4467 </td>
   <td style="text-align:right;"> 0.9395255 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ldh.sqrt.model.1.p3 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;"> 620.7792 </td>
   <td style="text-align:right;"> 671.8606 </td>
   <td style="text-align:right;"> 0.9419179 </td>
  </tr>
</tbody>
</table>

```r
anova(ldh.sqrt.model.1, ldh.sqrt.model.1.p2, ldh.sqrt.model.1.p3, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Resid. Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Resid. Dev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"177","2":"646.6709","3":"NA","4":"NA","5":"NA","_rn_":"1"},{"1":"173","2":"263.7005","3":"4","4":"382.97036","5":"4.153951e-54","_rn_":"2"},{"1":"169","2":"253.2683","3":"4","4":"10.43226","5":"1.379529e-01","_rn_":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

Once again the model that fits temperature as a second order polynomial seems to be the best fit. lets continue. 


```r
ldh.sqrt.model.1.p2 <- glmmTMB(sqrt(LDH_ACTIVITY) ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + (1|fish_id), 
               family = gaussian(),
               REML=TRUE,
               data = ldh.data)  
```

## Model validation [Transformed data] {.tabset}

### ldh.sqrt.model.1.p2 [performance]


```r
ldh.sqrt.model.1.p2 %>% check_model(detrend=FALSE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-trans-validatiaon-1-1.png)<!-- -->

### ldh.sqrt.model.1.p2 [DHARMa]


```r
ldh.sqrt.model.1.p2 %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-trans-validatiaon-2-1.png)<!-- -->

```
## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.64 0.876 0.988 0.98 0.744 0.608 0.288 0.184 0.048 0.016 0.424 0.136 0.064 0.84 0.756 0.548 0.164 0.504 0.664 0.12 ...
```

```r
ldh.sqrt.model.1.p2 %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/ldh-model-trans-validatiaon-2-2.png)<!-- -->

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.046595, p-value = 0.8167
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.93331, p-value = 0.68
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 3, observations = 185, p-value = 0.1842
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00335674 0.04665697
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                             0.01621622
```

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.046595, p-value = 0.8167
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.93331, p-value = 0.68
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 3, observations = 185, p-value = 0.1842
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00335674 0.04665697
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                             0.01621622
```

### {-}

## Important note 3 

It looks like transforming the data via a square root transformation really helps model performance. No significant data violations occur and the diagnostic plots start to look a lot better. This is definitely a viable and justifiable option. 

## Partial plots {.tabset} 

### ggemmeans {.tabset} 

#### TEMPERATURE V LATITUDE

![](01.DataAnalysis_files/figure-html/ldh-partial-plots-1-1.png)<!-- -->

#### TEMPERATURE V GENUS

![](01.DataAnalysis_files/figure-html/ldh-partial-plots-1b-1.png)<!-- -->

#### TEMPERATURE V GENUS V LATITUDE

![](01.DataAnalysis_files/figure-html/ldh-partial-plots-1c-1.png)<!-- -->

### plot_model 


```
## Formula contains log- or sqrt-terms.
##   See help("standardize") for how such terms are standardized.
```

![](01.DataAnalysis_files/figure-html/ldhpartial-plots-1d-1.png)<!-- -->

#### {-}

### {-}

## Model investigation {.tabset .tabset-pills}

### summary 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Estimate </th>
   <th style="text-align:right;"> StdError </th>
   <th style="text-align:right;"> Zvalue </th>
   <th style="text-align:right;"> Pvalue </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 8.4346789 </td>
   <td style="text-align:right;"> 0.3080404 </td>
   <td style="text-align:right;"> 27.3817260 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1 </td>
   <td style="text-align:right;"> 70.9630451 </td>
   <td style="text-align:right;"> 1.8988819 </td>
   <td style="text-align:right;"> 37.3709638 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2 </td>
   <td style="text-align:right;"> 19.5368497 </td>
   <td style="text-align:right;"> 1.8988819 </td>
   <td style="text-align:right;"> 10.2886073 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical </td>
   <td style="text-align:right;"> -1.9610952 </td>
   <td style="text-align:right;"> 0.4246044 </td>
   <td style="text-align:right;"> -4.6186404 </td>
   <td style="text-align:right;"> 0.0000039 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -2.0340178 </td>
   <td style="text-align:right;"> 0.4490422 </td>
   <td style="text-align:right;"> -4.5296802 </td>
   <td style="text-align:right;"> 0.0000059 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical </td>
   <td style="text-align:right;"> -17.2430040 </td>
   <td style="text-align:right;"> 2.6174280 </td>
   <td style="text-align:right;"> -6.5877663 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical </td>
   <td style="text-align:right;"> 0.3540222 </td>
   <td style="text-align:right;"> 2.6174280 </td>
   <td style="text-align:right;"> 0.1352557 </td>
   <td style="text-align:right;"> 0.8924097 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -17.9284819 </td>
   <td style="text-align:right;"> 2.7680722 </td>
   <td style="text-align:right;"> -6.4768838 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -0.2303339 </td>
   <td style="text-align:right;"> 2.7680722 </td>
   <td style="text-align:right;"> -0.0832109 </td>
   <td style="text-align:right;"> 0.9336838 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 2.6499146 </td>
   <td style="text-align:right;"> 0.6102778 </td>
   <td style="text-align:right;"> 4.3421448 </td>
   <td style="text-align:right;"> 0.0000141 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 24.4703881 </td>
   <td style="text-align:right;"> 3.7619912 </td>
   <td style="text-align:right;"> 6.5046373 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -0.1764252 </td>
   <td style="text-align:right;"> 3.7619912 </td>
   <td style="text-align:right;"> -0.0468968 </td>
   <td style="text-align:right;"> 0.9625955 </td>
  </tr>
</tbody>
</table>

### anova 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Chisq </th>
   <th style="text-align:right;"> Df </th>
   <th style="text-align:right;"> Pr(&gt;Chisq) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2) </td>
   <td style="text-align:right;"> 4477.657660 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDE </td>
   <td style="text-align:right;"> 4.946896 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0261376 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUS </td>
   <td style="text-align:right;"> 3.884675 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0487287 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATITUDE </td>
   <td style="text-align:right;"> 8.262648 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.0160616 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATIN_GENUS </td>
   <td style="text-align:right;"> 6.263802 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.0436348 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDE:LATIN_GENUS </td>
   <td style="text-align:right;"> 18.854222 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0000141 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATITUDE:LATIN_GENUS </td>
   <td style="text-align:right;"> 42.312505 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
</tbody>
</table>

### confint 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> 2.5 % </th>
   <th style="text-align:right;"> 97.5 % </th>
   <th style="text-align:right;"> Estimate </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 7.8309307 </td>
   <td style="text-align:right;"> 9.038427 </td>
   <td style="text-align:right;"> 8.4346789 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1 </td>
   <td style="text-align:right;"> 67.2413051 </td>
   <td style="text-align:right;"> 74.684785 </td>
   <td style="text-align:right;"> 70.9630451 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2 </td>
   <td style="text-align:right;"> 15.8151097 </td>
   <td style="text-align:right;"> 23.258590 </td>
   <td style="text-align:right;"> 19.5368497 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical </td>
   <td style="text-align:right;"> -2.7933047 </td>
   <td style="text-align:right;"> -1.128886 </td>
   <td style="text-align:right;"> -1.9610952 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -2.9141244 </td>
   <td style="text-align:right;"> -1.153911 </td>
   <td style="text-align:right;"> -2.0340178 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical </td>
   <td style="text-align:right;"> -22.3730686 </td>
   <td style="text-align:right;"> -12.112939 </td>
   <td style="text-align:right;"> -17.2430040 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical </td>
   <td style="text-align:right;"> -4.7760425 </td>
   <td style="text-align:right;"> 5.484087 </td>
   <td style="text-align:right;"> 0.3540222 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -23.3538037 </td>
   <td style="text-align:right;"> -12.503160 </td>
   <td style="text-align:right;"> -17.9284819 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -5.6556557 </td>
   <td style="text-align:right;"> 5.194988 </td>
   <td style="text-align:right;"> -0.2303339 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 1.4537921 </td>
   <td style="text-align:right;"> 3.846037 </td>
   <td style="text-align:right;"> 2.6499146 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 17.0970209 </td>
   <td style="text-align:right;"> 31.843755 </td>
   <td style="text-align:right;"> 24.4703881 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -7.5497924 </td>
   <td style="text-align:right;"> 7.196942 </td>
   <td style="text-align:right;"> -0.1764252 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Std.Dev.(Intercept)|fish_id </td>
   <td style="text-align:right;"> 0.6071386 </td>
   <td style="text-align:right;"> 1.117678 </td>
   <td style="text-align:right;"> 0.8237628 </td>
  </tr>
</tbody>
</table>

### r-squared
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:right;"> R2_conditional </th>
   <th style="text-align:right;"> R2_marginal </th>
   <th style="text-align:left;"> optional </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.9631806 </td>
   <td style="text-align:right;"> 0.9346937 </td>
   <td style="text-align:left;"> FALSE </td>
  </tr>
</tbody>
</table>

### {-} 

## Pairwise comparisons {.tabset .tabset-faded} 

### emtrends 


```r
ldh.sqrt.model.1.p2 %>% emtrends(var = "temperature", type = "response") %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["t.ratio"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"(sub-tropical Apogon) - tropical Apogon","2":"30","3":"0.08963589","4":"0.01360744","5":"183","6":"0.05344275","7":"0.1258290213","8":"6.5872714","9":"2.767336e-09","_rn_":"1"},{"1":"(sub-tropical Apogon) - (sub-tropical Pomacentrus)","2":"30","3":"0.09320979","4":"0.01439060","5":"183","6":"0.05493358","7":"0.1314859911","8":"6.4771281","9":"5.024308e-09","_rn_":"2"},{"1":"(sub-tropical Apogon) - tropical Pomacentrus","2":"30","3":"0.05563328","4":"0.01360744","5":"183","6":"0.01944015","7":"0.0918264189","8":"4.0884467","9":"3.897124e-04","_rn_":"3"},{"1":"tropical Apogon - (sub-tropical Pomacentrus)","2":"30","3":"0.00357390","4":"0.01404792","5":"183","6":"-0.03379083","7":"0.0409386350","8":"0.2544077","9":"9.999350e-01","_rn_":"4"},{"1":"tropical Apogon - tropical Pomacentrus","2":"30","3":"-0.03400260","4":"0.01324451","5":"183","6":"-0.06923041","7":"0.0012252075","8":"-2.5672983","9":"6.448713e-02","_rn_":"5"},{"1":"(sub-tropical Pomacentrus) - tropical Pomacentrus","2":"30","3":"-0.03757650","4":"0.01404792","5":"183","6":"-0.07494124","7":"-0.0002117675","8":"-2.6748798","9":"4.793152e-02","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
SCROLL TO THE RIGHT -->

The numbers in the left most column in the table just mention that the slopes are assuming mean **MASS_CENTERED** and **RESTING_TIME_SEONDS** values when looking at differences between latitudinal slopes.

### emmeans [response]

```r
ldh.sqrt.model.1.p2 %>% emmeans(pairwise ~ temperature*LATITUDE*LATIN_GENUS, type = "response") %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["t.ratio"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"(sub-tropical Apogon) - tropical Apogon","2":"30","3":"1.99220492","4":"0.4828994","5":"183","6":"0.7077865","7":"3.2766233","8":"4.12550686","9":"0.0003365165","_rn_":"1"},{"1":"(sub-tropical Apogon) - (sub-tropical Pomacentrus)","2":"30","3":"2.01377720","4":"0.5106924","5":"183","6":"0.6554350","7":"3.3721194","8":"3.94322952","9":"0.0006860591","_rn_":"2"},{"1":"(sub-tropical Apogon) - tropical Pomacentrus","2":"30","3":"1.34056421","4":"0.4828994","5":"183","6":"0.0561458","7":"2.6249826","8":"2.77607328","9":"0.0358953494","_rn_":"3"},{"1":"tropical Apogon - (sub-tropical Pomacentrus)","2":"30","3":"0.02157227","4":"0.4985313","5":"183","6":"-1.3044238","7":"1.3475683","8":"0.04327165","9":"0.9999999983","_rn_":"4"},{"1":"tropical Apogon - tropical Pomacentrus","2":"30","3":"-0.65164071","4":"0.4700198","5":"183","6":"-1.9018018","7":"0.5985204","8":"-1.38641121","9":"0.6666457949","_rn_":"5"},{"1":"(sub-tropical Pomacentrus) - tropical Pomacentrus","2":"30","3":"-0.67321298","4":"0.4985313","5":"183","6":"-1.9992091","7":"0.6527831","8":"-1.35039268","9":"0.6927708681","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
### emmeans [ratios]

```r
ldh.sqrt.model.1.p2 %>% emmeans(pairwise ~ temperature*LATITUDE*LATIN_GENUS, type = "response") %>% regrid(transform = "log")  %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=FALSE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["fct"],"align":["left"]},{"label":["ratio"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(sub-tropical Apogon) / tropical Apogon","2":"30","3":"2.0208627","4":"0.3538709","5":"183","_rn_":"1"},{"1":"(sub-tropical Apogon) / (sub-tropical Pomacentrus)","2":"30","3":"2.0394400","4":"0.3860778","5":"183","_rn_":"2"},{"1":"(sub-tropical Apogon) / tropical Pomacentrus","2":"30","3":"1.5607503","4":"0.2524291","5":"183","_rn_":"3"},{"1":"tropical Apogon / (sub-tropical Pomacentrus)","2":"30","3":"1.0091927","4":"0.2134710","5":"183","_rn_":"4"},{"1":"tropical Apogon / tropical Pomacentrus","2":"30","3":"0.7723188","4":"0.1446222","5":"183","_rn_":"5"},{"1":"(sub-tropical Pomacentrus) / tropical Pomacentrus","2":"30","3":"0.7652838","4":"0.1535130","5":"183","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>


### temperature 

```r
ldh.sqrt.model.1.p2 %>% emmeans(~ temperature*LATITUDE*LATIN_GENUS, type = "response") %>% regrid(transform = "log")  %>% summary(infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["temperature"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["LATITUDE"],"name":[2],"type":["fct"],"align":["left"]},{"label":["LATIN_GENUS"],"name":[3],"type":["fct"],"align":["left"]},{"label":["response"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["null"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["t.ratio"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"30","2":"sub-tropical","3":"Apogon","4":"45.12990","5":"4.706977","6":"183","7":"36.73621","8":"55.44142","9":"1","10":"36.52544","11":"5.610387e-86","_rn_":"1"},{"1":"30","2":"tropical","3":"Apogon","4":"22.33200","5":"3.141195","6":"183","7":"16.92004","8":"29.47499","9":"1","10":"22.08193","11":"1.700690e-53","_rn_":"2"},{"1":"30","2":"sub-tropical","3":"Pomacentrus","4":"22.12857","5":"3.495931","6":"183","7":"16.20254","8":"30.22204","9":"1","10":"19.60259","11":"7.882817e-47","_rn_":"3"},{"1":"30","2":"tropical","3":"Pomacentrus","4":"28.91552","5":"3.574346","6":"183","7":"22.65742","8":"36.90212","9":"1","10":"27.21693","11":"3.041160e-66","_rn_":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### temperture [combined]

```r
ldh.means.temp <- ldh.sqrt.model.1.p2 %>% update(sqrt(LDH_ACTIVITY) ~ factor(temperature) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass) + (1|fish_id)) %>% emmeans(pairwise ~ temperature, type = "response"); ldh.means.temp$emmeans
```

```
## NOTE: Results may be misleading due to involvement in interactions
```

```
##  temperature response   SE  df lower.CL upper.CL
##           10     8.26 1.14 183     6.16     10.7
##           20    10.36 1.28 183     8.00     13.0
##           30    27.56 2.08 183    23.60     31.8
##           40    98.99 3.95 183    91.35    106.9
##           50   224.22 5.95 183   212.64    236.1
## 
## Results are averaged over the levels of: LATITUDE, LATIN_GENUS 
## Confidence level used: 0.95 
## Intervals are back-transformed from the sqrt scale
```

```r
ldh.means.temp.df <- ldh.means.temp$emmeans %>% as.data.frame() %>% 
  mutate("\u394 change"=response - lag(response, n=1, default = first(response)), 
         "\u394 %change" = response/lag(response, n=1, default = first(response))*100) 
ldh.means.temp.df[1,8] = 0.0000 

ldh.means.temp.df %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:right;"> temperature </th>
   <th style="text-align:right;"> response </th>
   <th style="text-align:right;"> SE </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> lower.CL </th>
   <th style="text-align:right;"> upper.CL </th>
   <th style="text-align:right;">  change </th>
   <th style="text-align:right;">  %change </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 8.260585 </td>
   <td style="text-align:right;"> 1.141341 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 6.162175 </td>
   <td style="text-align:right;"> 10.66593 </td>
   <td style="text-align:right;"> 0.000000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 10.364607 </td>
   <td style="text-align:right;"> 1.278458 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 7.995663 </td>
   <td style="text-align:right;"> 13.04049 </td>
   <td style="text-align:right;"> 2.104021 </td>
   <td style="text-align:right;"> 125.4706 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:right;"> 27.555998 </td>
   <td style="text-align:right;"> 2.084577 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 23.596571 </td>
   <td style="text-align:right;"> 31.82236 </td>
   <td style="text-align:right;"> 17.191391 </td>
   <td style="text-align:right;"> 265.8663 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:right;"> 98.994020 </td>
   <td style="text-align:right;"> 3.951067 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 91.351986 </td>
   <td style="text-align:right;"> 106.94299 </td>
   <td style="text-align:right;"> 71.438022 </td>
   <td style="text-align:right;"> 359.2467 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:right;"> 224.220811 </td>
   <td style="text-align:right;"> 5.946314 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 212.642130 </td>
   <td style="text-align:right;"> 236.10643 </td>
   <td style="text-align:right;"> 125.226791 </td>
   <td style="text-align:right;"> 226.4993 </td>
  </tr>
</tbody>
</table>



### Means - f(temperature)

```r
ldh.means <- ldh.sqrt.model.1.p2 %>% update(sqrt(LDH_ACTIVITY) ~ factor(temperature) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass) + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response")

ldh.means.df <- ldh.means$emmeans %>% as.data.frame() %>% 
  mutate("change"=response - lag(response, n=1, default = first(response)), 
         "%change" = response/lag(response, n=1, default = first(response))*100) %>% 
  mutate("%change" = case_when(temperature == 10 ~ 0, 
                                     TRUE ~ `%change`), 
         "change" = case_when(temperature == 10 ~ 0, 
                                     TRUE ~ `change`)) #%>% 
  #rename("\u394 %change" = "%change", 
         #"\u394 change" = "change")

ldh.means.df %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:right;"> temperature </th>
   <th style="text-align:left;"> LATIN_GENUS </th>
   <th style="text-align:left;"> LATITUDE </th>
   <th style="text-align:right;"> response </th>
   <th style="text-align:right;"> SE </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> lower.CL </th>
   <th style="text-align:right;"> upper.CL </th>
   <th style="text-align:right;"> change </th>
   <th style="text-align:right;"> %change </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 11.493282 </td>
   <td style="text-align:right;"> 2.773751 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 6.672102 </td>
   <td style="text-align:right;"> 17.61739 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 15.374671 </td>
   <td style="text-align:right;"> 3.208103 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 9.696509 </td>
   <td style="text-align:right;"> 22.35576 </td>
   <td style="text-align:right;"> 3.8813892 </td>
   <td style="text-align:right;"> 133.7709 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 44.553943 </td>
   <td style="text-align:right;"> 5.461206 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 34.430383 </td>
   <td style="text-align:right;"> 55.98043 </td>
   <td style="text-align:right;"> 29.1792715 </td>
   <td style="text-align:right;"> 289.7879 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 157.317833 </td>
   <td style="text-align:right;"> 10.262057 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 137.722136 </td>
   <td style="text-align:right;"> 178.21646 </td>
   <td style="text-align:right;"> 112.7638908 </td>
   <td style="text-align:right;"> 353.0952 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 307.137775 </td>
   <td style="text-align:right;"> 14.338775 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 279.498665 </td>
   <td style="text-align:right;"> 336.07981 </td>
   <td style="text-align:right;"> 149.8199421 </td>
   <td style="text-align:right;"> 195.2339 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 6.026724 </td>
   <td style="text-align:right;"> 2.142564 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 2.540705 </td>
   <td style="text-align:right;"> 10.99531 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 6.733757 </td>
   <td style="text-align:right;"> 2.264759 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 3.006647 </td>
   <td style="text-align:right;"> 11.94344 </td>
   <td style="text-align:right;"> 0.7070331 </td>
   <td style="text-align:right;"> 111.7316 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 18.201108 </td>
   <td style="text-align:right;"> 3.723421 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 11.596041 </td>
   <td style="text-align:right;"> 26.28875 </td>
   <td style="text-align:right;"> 11.4673515 </td>
   <td style="text-align:right;"> 270.2965 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 72.102559 </td>
   <td style="text-align:right;"> 7.410859 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 58.222132 </td>
   <td style="text-align:right;"> 87.46556 </td>
   <td style="text-align:right;"> 53.9014507 </td>
   <td style="text-align:right;"> 396.1438 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 176.688689 </td>
   <td style="text-align:right;"> 11.601057 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 154.540950 </td>
   <td style="text-align:right;"> 200.31900 </td>
   <td style="text-align:right;"> 104.5861299 </td>
   <td style="text-align:right;"> 245.0519 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 9.188917 </td>
   <td style="text-align:right;"> 2.355573 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 5.129006 </td>
   <td style="text-align:right;"> 14.42415 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 10.523630 </td>
   <td style="text-align:right;"> 2.520851 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 6.137624 </td>
   <td style="text-align:right;"> 16.08496 </td>
   <td style="text-align:right;"> 1.3347130 </td>
   <td style="text-align:right;"> 114.5252 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 23.735442 </td>
   <td style="text-align:right;"> 3.785847 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 16.853584 </td>
   <td style="text-align:right;"> 31.79263 </td>
   <td style="text-align:right;"> 13.2118121 </td>
   <td style="text-align:right;"> 225.5443 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 81.665896 </td>
   <td style="text-align:right;"> 7.022386 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 68.398307 </td>
   <td style="text-align:right;"> 96.10881 </td>
   <td style="text-align:right;"> 57.9304545 </td>
   <td style="text-align:right;"> 344.0673 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 198.774197 </td>
   <td style="text-align:right;"> 10.955807 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 177.745923 </td>
   <td style="text-align:right;"> 220.97780 </td>
   <td style="text-align:right;"> 117.1083009 </td>
   <td style="text-align:right;"> 243.3993 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 6.864703 </td>
   <td style="text-align:right;"> 1.925595 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 3.591145 </td>
   <td style="text-align:right;"> 11.18959 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 9.719592 </td>
   <td style="text-align:right;"> 2.291279 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 5.724534 </td>
   <td style="text-align:right;"> 14.76598 </td>
   <td style="text-align:right;"> 2.8548888 </td>
   <td style="text-align:right;"> 141.5879 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 26.878727 </td>
   <td style="text-align:right;"> 3.810293 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 19.886637 </td>
   <td style="text-align:right;"> 34.92214 </td>
   <td style="text-align:right;"> 17.1591353 </td>
   <td style="text-align:right;"> 276.5417 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 94.622578 </td>
   <td style="text-align:right;"> 7.149100 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 81.042982 </td>
   <td style="text-align:right;"> 109.25350 </td>
   <td style="text-align:right;"> 67.7438512 </td>
   <td style="text-align:right;"> 352.0352 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 224.385757 </td>
   <td style="text-align:right;"> 11.009095 </td>
   <td style="text-align:right;"> 183 </td>
   <td style="text-align:right;"> 203.190344 </td>
   <td style="text-align:right;"> 246.63250 </td>
   <td style="text-align:right;"> 129.7631789 </td>
   <td style="text-align:right;"> 237.1376 </td>
  </tr>
</tbody>
</table>

### Means - f(temperature) [ratios]

```r
ldh.sqrt.model.1.p2 %>% update(sqrt(LDH_ACTIVITY) ~ factor(temperature) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass) + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response")  %>% regrid(transform = "log") %>% pairs(by =c("temperature")) %>% summary(infer=FALSE)
```



### Abs. diff - f(temperature)

```r
ldh.sqrt.model.1.p2 %>% update(sqrt(LDH_ACTIVITY) ~ factor(temperature) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass) + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response") %>% regrid() %>% pairs(by =c("LATIN_GENUS","LATITUDE")) %>% summary(infer=TRUE, type = "response")
```

### Genus comparisons

```r
ldh.sqrt.model.1.p2 %>% update(sqrt(LDH_ACTIVITY) ~ factor(temperature) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass) + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response") %>% regrid() %>% pairs(by =c("LATIN_GENUS")) %>% summary(infer=TRUE, type = "response")
```

### Genus [combined]

```r
ldh.means.genus <- ldh.sqrt.model.1.p2 %>% update(LDH_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass) + (1|fish_id)) %>% emmeans(pairwise ~ LATIN_GENUS, type = "response") %>% summary(infer=TRUE); ldh.means.genus
```

### effect size [emmeans]

```r
ldh.emm <- ldh.sqrt.model.1.p2 %>% emmeans(~temperature*LATITUDE*LATIN_GENUS) %>% regrid()
eff_size(ldh.emm, sigma = sigma(ldh.sqrt.model.1.p2d), edf=df.residual(ldh.sqrt.model.1.p2d))
```

### effect size [emtrends]

```r
ldh.emm <- ldh.sqrt.model.1.p2 %>% emtrends(var = "temperature")
eff_size(ldh.emm, sigma = sigma(ldh.sqrt.model.1.p2d), edf=df.residual(ldh.sqrt.model.1.p2d))
```

### {-}

## Summary figure 



```r
ldh.emm <- emmeans(ldh.sqrt.model.1.p2, ~temperature|LATITUDE|LATIN_GENUS, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") 

ldh.emm.df <- ldh.emm %>% as.data.frame() %>%
  unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 

ldh.obs <-  ldh.data %>% 
  mutate(Pred=predict(ldh.sqrt.model.1.p2, re.form=NA, type="response"),
         Resid = residuals(ldh.sqrt.model.1.p2, type="response"),
         Fit = Pred + Resid) %>%
   unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 


ldh.plot <- ggplot(ldh.emm.df, aes(y=response, x=temperature, linetype=species, color = species, fill=species))+
  geom_jitter(data=ldh.obs, 
              aes(y=Fit^2, color = species), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= lower.CL, ymax= upper.CL),
              alpha = 0.2, 
              color=NA)+ 
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,350), breaks = seq(0, 350, by = 50)) +
  theme_classic() + 
  ylab(expression("LDH ACTIVITY (U mg "^{-1} * "tissue)")) + 
  xlab("")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis"))+
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) + 
  theme(legend.position = "top", 
        legend.text = element_text(size = 10), 
        legend.title = element_blank(), 
        axis.title = element_text(size =12), 
        axis.text = element_text(size=10)); ldh.plot
```

![](01.DataAnalysis_files/figure-html/ldh-sum-fig-1.png)<!-- -->

## Arrhenius plot 

```r
ldh.arrhenius.plot <- ggplot(ldh.emm.df, aes(y=log(response), x=1/(temperature+273.15), linetype=species, color = species, fill=species))+
  geom_jitter(data=ldh.obs, 
              aes(y=log(Fit^2), color = species), 
              #width=0.005, 
              alpha = 0.3, 
              size = 2) +
  stat_poly_line(method="lm", se = TRUE) + 
  stat_poly_eq(use_label(c("eq", "R2")), hjust = -1.6)+
  #geom_ribbon(aes(x=1/(temperature+273.15), 
              #ymin= log(asymp.LCL), ymax= log(asymp.UCL)),
              #alpha = 0.2, 
              #color=NA)+ 
  #scale_x_continuous(limits = c(9, 52), 
                     #breaks = seq(10, 52, by = 10))+ 
  #scale_y_continuous(limits = c(0,120), breaks = seq(0, 120, by = 20)) +
  theme_classic() + 
  ylab(expression("log(LDH (U mg "^{-1} * "tissue))")) + 
  xlab("")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis"))+
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) + 
  theme(legend.position = "top", 
        legend.text = element_text(size = 10), 
        legend.title = element_blank(), 
        axis.title = element_text(size =12), 
        axis.text = element_text(size=10)); ldh.arrhenius.plot
```

```
## Warning: The `scale_name` argument of `continuous_scale()` is deprecated as of ggplot2
## 3.5.0.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

```
## Warning: The `trans` argument of `continuous_scale()` is deprecated as of ggplot2 3.5.0.
##  Please use the `transform` argument instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

![](01.DataAnalysis_files/figure-html/ldh-arrhenius plot-1.png)<!-- -->

# Citrate synthase (CS)

## Load data 



```r
cs <- cs.import.data
```

## Data manipulation

```r
#--- data preparation/manipulation ---# 
cs2 <- cs |>
  clean_names() |>
  separate(sample, into=c('tissue_type','species','replicate','temperature'), sep = "_", remove = FALSE) |>  
  separate(creation_time, into=c('DATE','TIME'), sep = " ", remove = FALSE) |>
  arrange(sample_id_1, DATE, TIME) 

cs3 <- cs2 |> 
  mutate(TIME = hms(cs2$TIME)) |>
  mutate(TIME = chron(times=cs2$TIME)) |>
  arrange(TIME) |>
  dplyr::group_by(sample, sample_id_1) |> 
  dplyr::mutate(TIME_DIFF = TIME - first(TIME)) |> 
  dplyr::filter(TIME != first(TIME)) |>
  dplyr::ungroup() |> 
  mutate(TIME_DIFF_SECS = period_to_seconds(hms(TIME_DIFF))) |> 
  mutate(MINUTES = TIME_DIFF_SECS/60) |> 
  mutate(MINUTES = round(MINUTES, digits = 2)) |> 
  dplyr::rename(CUVETTE = sample_id_1) |> 
  mutate(LATIN_NAME = case_when( species =="Adoed"~ "Apogon doederlein", 
                             species == "Arub" ~ "Apogon rubrimacula", 
                             species == "Paus" ~ "Pomacentrus australis",
                             species == "Pmol" ~ "Pomacentrus moluccensis",
                             TRUE ~ "na")) |> 
  unite("UNIQUE_SAMPLE_ID", c(species, replicate, temperature, sample_index), sep="_", remove = FALSE)
```

### Data cleaning 

Next select data points will be removed. Data points have been checked using previously written app script that allows the user to look at the plotted points of samples that were run. Because we are interested in the slope, points that plateaued were removed from the analysis, as it signifies that the reaction ran out of 'fuel' to use.

Note that later on the first data point will be removed from all samples. For example, if a run requires that the first 4 data points be removed, 3 will be removed below and then one will be removed at a later step. 


* **grp2**: removed first 2 data points which was causing a plateau
* **grp3**: removed first 3 data points which was causing a plateau
* **grp4**: removed first 4 data points which was causing a plateau
* **grp5**: removed first 5 data points which was causing a plateau


```r
grp1 <- c("Arub_04_30_3","Paus_02_30_2","Pmol_01_20_3","Pmol_03_30_1","Pmol_03_30_3", 
          "Paus_08_10_2", "Paus_10_40_1", "Pmol_07_20_2","Pmol_09_10_1","Arub_06_30_3",
          "Pmol_10_20_1") 
grp2 <- c("Arub_04_30_3","Paus_02_30_1","Pmol_06_30_1","Pmol_10_10_1","Pmol_10_10_2", 
          "Pmol_03_20_2","Pmol_05_30_3","Adoed_09_20_3","Pmol_09_30_3")
grp3 <- c("Adoed_03_20_3","Pmol_03_30_2","Pmol_03_10_3","Pmol_03_10_1","Pmol_03_30_2") 
grp4 <- c("Arub_04_30_2","Arub_06_30_1","Adoed_05_20_2","Pmol_02_30_3","Pmol_03_10_1","Pmol_03_10_1", 
          "Arub_06_30_1", "Adoed_05_20_2","Arub_02_20_1") 
grp5 <- c("Pmol_01_20_2","Arub_02_20_3")  
grp6 <- c("Arub_06_30_2","Pmol_02_30_1","Pmol_09_20_1","Arub_06_30_2") 
grp7 <- c("Arub_04_30_1","Pmol_03_10_2","Pmol_03_10_2","Pmol04_20_1") 
grp8 <- c("Pmol_02_30_2","Pmol_09_20_3","Pmol_06_20_2") 
grp9 <- c("Adoed_03_20_2","Pmol_03_40_3","Pmol_04_20_3") 
grp10 <- c() 
grp11 <- c("Pmol_04_20_1","Pmol_09_20_2","Pmol_04_20_5","Arub_02_20_2") 
data.grp1 <- c("Pmol_01_10_2") 
data.grp2 <- c("Pmol_05_20_3")
data.grp3 <- c("Pmol_07_20_3","Pmol_10_10_1")
data.grp4 <- c("Pmol_07_10_1") 
data.grp7 <- c("Pmol_05_30_3")
data.grp8 <- c("Adoed_05_50_5")
```



```r
cs3.filtered <- cs3 |> 
  filter(!(UNIQUE_SAMPLE_ID %in% c(
                                   #--- Apogon rubrimacula ---#
                                   #"Arub_02_10_1", "Arub_02_10_2", "Arub_02_10_3", # control slope steep - fixed
                                   #"Arub_02_20_1", "Arub_02_20_2", "Arub_02_20_3", # slopes messy - fixed
                                   #"Arub_03_50_1", "Arub_03_50_2", "Arub_03_50_3", # control slope steep - fixed
                                   "Arub_04_10_1", "Arub_04_10_2", "Arub_04_10_3", # slopes messy - fixed
                                   "Arub_04_20_1", "Arub_04_20_2", "Arub_04_20_3", # slopes are all negative
                                   #"Arub_05_30_1", "Arub_05_30_2", "Arub_05_30_3", # control slope steep - fixed
                                   "Arub_06_20_1", "Arub_06_20_2", "Arub_06_20_3", # slopes all negative
                                   "Arub_10_30_3", 
                                   "Arub_01_50_1", "Arub_01_50_2", "Arub_01_50_3", # slopes look fine but are much shallower 
                                                                                   # than all other samples
                                   
                                   #--- Apogon doederlein ---# 
                                   "Adoed_09_10_1", 
                                   "Adoed_08_10_1", 
                                   "Adoed_08_20_3", 
                                   "Adoed_08_30_1", 
                                   "Adoed_06_10_1",
                                   
                                   #--- Pomacentrus australia ---#
                                   "Paus_02_10_2",  
                                   "Paus_02_20_1", "Paus_02_20_2", "Paus_02_20_3", 
                                   
                                   #--- Pomacentrus moluccensis  
                                   "Pmol_02_20_1", "Pmol_02_20_2", "Pmol_02_20_3", 
                                   "Pmol_03_20_1", "Pmol_03_20_3", 
                                   "Pmol_03_10_2",
                                   "Pmol_04_20_2", 
                                   "Pmol_05_20_1", "Pmol_05_20_2",
                                   "Pmol_06_50_3",
                                   "Pmol_06_20_2", 
                                   "Pmol_04_10_2"
                                   ))) |>
  dplyr::group_by(UNIQUE_SAMPLE_ID) |> 
  dplyr::arrange(UNIQUE_SAMPLE_ID, TIME) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp1 & row_number() <= 1)) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp2 & row_number() <= 2)) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp3 & row_number() <= 3)) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp4 & row_number() <= 4)) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp5 & row_number() <= 5)) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp6 & row_number() <= 6)) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp7 & row_number() <= 7)) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp8 & row_number() <= 8)) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp9 & row_number() <= 9)) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp10 & row_number() <= 10)) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% grp11 & row_number() <= 11)) |> 
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% data.grp1 & row_number() == 4)) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% data.grp2 & between(row_number(), 7, 10))) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% data.grp3 & row_number() == 4 )) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% data.grp4 & row_number() == 10 )) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% data.grp7 & between(row_number(), 9, 13))) |>
  dplyr::filter(!(UNIQUE_SAMPLE_ID %in% data.grp8 & between(row_number(), 15, 20))) |>
  dplyr::ungroup() |> 
  mutate(UNIQUE_SAMPLE_ID = str_sub(UNIQUE_SAMPLE_ID, end = -3))
```

Great! Now we have all the data points that we want to keep. However, the data needs to manipulated in a way that we can obtain and pull out slopes from the absorption readings, and the calculate enzyme activity based on these slopes. This will involve a number of steps.  

### Data calculations 

#### Step1: Extract slopes 

Step1 will produce a data frame that provides you with the slope that was obtained for cuvettes 1-3 for each sample run at each experimental temperature. Note that at the end of this step we are removing slopes that were positive in value, as LDH slopes should produce a negative slope, due to NADH being used up. 

```r
CS_activity <- cs3.filtered %>% 
  group_by(UNIQUE_SAMPLE_ID, CUVETTE) %>% 
  do({
    mod = lm(result ~ MINUTES, data = .)
    data.frame(Intercept = coef(mod)[1],
               Slope = coef(mod)[2], 
               r2 = summary(mod)$adj.r.squared)
  }) %>%
  ungroup() %>%
  filter(CUVETTE != ("6"))%>% 
  filter(CUVETTE != ("4"))%>% 
  filter(CUVETTE != ("5")) %>% 
  filter(Slope >= 0)
```

#### Step2: Slope means

Step2 will calculate the mean slope for cuvette 1-3. 

```r
CS_activity_means <- CS_activity %>% 
  dplyr::group_by(UNIQUE_SAMPLE_ID) %>% 
  mutate(Mean = mean(Slope)) %>% 
  dplyr::ungroup()
```

#### Step3: Background activity level

Step3 will calculate background activity level by measuring the slope from cuvette 5 (postive control)

```r
CS_background <- cs3.filtered %>% 
  group_by(UNIQUE_SAMPLE_ID, CUVETTE) %>% 
  do({
    mod = lm(result ~ MINUTES, data = .)
    data.frame(Intercept = coef(mod)[1],
               Slope = coef(mod)[2], 
               r2 = summary(mod)$adj.r.squared)
  }) %>%
  ungroup() %>%
  filter(CUVETTE == ("5")) %>% 
  dplyr::rename(Background = Slope)  
```

#### Step4: Merging dataframes

Step4 will merge the data frames that you created with the mean slopes and the background slopes.

```r
cs_final_table <- CS_activity %>% 
  full_join(distinct(CS_activity_means[,c(1,6)]), by = "UNIQUE_SAMPLE_ID") %>%
  full_join(CS_background[,c(1,4)], by = "UNIQUE_SAMPLE_ID") 
cs_final_table$Mean[duplicated(cs_final_table$Mean)] <- ""
cs_final_table$Background[duplicated(cs_final_table$Background)] <- ""
cs_final_table <- cs_final_table %>% 
  mutate(Mean = as.numeric(Mean), 
         Background = as.numeric(Background), 
         Background_perc = Background/Mean) %>% 
  drop_na(Mean) %>% 
  mutate(Background_perc = case_when(UNIQUE_SAMPLE_ID == "Adoed_03_40" ~ 0.0000, # ignore blank - QC
                                     UNIQUE_SAMPLE_ID == "Pmol_07_30" ~ 0.0000, 
                                     UNIQUE_SAMPLE_ID == "Arub_03_50" ~ 0.0000, 
                                     UNIQUE_SAMPLE_ID == "Paus_07_10" ~ 0.0000,
                                     UNIQUE_SAMPLE_ID == "Paus_02_10" ~ 0.0000,
                                     UNIQUE_SAMPLE_ID == "Adoed_06_10" ~ 0.0000,
                                     UNIQUE_SAMPLE_ID == "Arub_02_10" ~ 0.0000,
                                     TRUE ~ Background_perc))
```

#### Step5: Enzyme activity levels 

Step5 is where enzyme activity levels are calculated. See further details in manuscript (doi: xxx). Within this step background activity level is taken into account and subtracted from slopes where background activity was >5% or more of the sample slope. 

```r
CS.data <- cs_final_table %>% 
  select(c(UNIQUE_SAMPLE_ID, Mean, Background, Background_perc)) %>% 
  mutate(Mean = as.numeric(Mean), 
         Background = as.numeric(Background), 
         Background_perc = as.numeric(Background_perc)) %>% 
  mutate(Background2 = case_when(Background_perc <= 0.05 ~ 0, 
                                 TRUE ~ Background), 
         CS_ABSORBANCE = Mean - Background2) %>%
  inner_join(select(cs3.filtered, c(UNIQUE_SAMPLE_ID, species, replicate, temperature, LATIN_NAME)), by ="UNIQUE_SAMPLE_ID") %>% 
  unite("fish_id", c(species,replicate), sep = "_", remove = FALSE) %>%
  inner_join(tissue.mass, by = "fish_id") %>% 
  mutate(TISSUE_MASS_CENTERED = scale(tissue_mass, center = TRUE, scale = FALSE)) %>%
  distinct(UNIQUE_SAMPLE_ID, .keep_all = TRUE) %>% 
  mutate(PATH_LENGTH = 1, 
         EXTINCTION_COEFFICIENT = 13.6, 
         TISSUE_CONCENTRATION = 0.01, 
         ASSAY_VOL = 0.930, 
         SAMPLE_VOL = 0.020, 
         CS_ACTIVITY = ((CS_ABSORBANCE/(PATH_LENGTH*EXTINCTION_COEFFICIENT*TISSUE_CONCENTRATION))*(ASSAY_VOL/SAMPLE_VOL)))   %>% 
  separate(LATIN_NAME, c("LATIN_GENUS","LATIN_SPECIES"), sep = " ", remove = FALSE) %>% 
  mutate(LATIN_GENUS = factor(LATIN_GENUS), 
         LATIN_SPECIES = factor(LATIN_SPECIES)) %>% 
  mutate(LATITUDE = factor(case_when(species =="Adoed"~ "sub-tropical", 
                             species == "Arub" ~ "tropical", 
                             species == "Paus" ~ "sub-tropical",
                             species == "Pmol" ~ "tropical",
                             TRUE ~ "na")), 
         temperature = as.numeric(temperature)) %>% 
  drop_na() %>% filter(CS_ACTIVITY >=0) |> 
  left_join(select(fish_mass, c("fish_id","standard_length","mass")), by="fish_id") |> 
  dplyr::rename(MASS = mass)
```




## Initial plot {.tabset}

### CS v TEMPERATURE [SPECIES]


```r
ggplot(CS.data, aes(x =temperature, y= CS_ACTIVITY, color = species)) + 
  geom_point() + 
  stat_smooth(method = "lm", se=FALSE) + 
  theme_classic() 
```

![](01.DataAnalysis_files/figure-html/cs-initial-plots-1.png)<!-- -->

### CS [distribution]

```r
ggplot(CS.data, aes(x = CS_ACTIVITY, fill = temperature, color = temperature)) + 
  geom_density(alpha =0.5, position = "identity") 
```

![](01.DataAnalysis_files/figure-html/cs-initial-plots-2-1.png)<!-- -->

```r
ggplot(CS.data, aes(x=CS_ACTIVITY)) + geom_histogram()
```

![](01.DataAnalysis_files/figure-html/cs-initial-plots-2-2.png)<!-- -->

### CS v TEMPERATURE [LATITUDE]

```r
ggplot(CS.data, aes(x =temperature, y= CS_ACTIVITY, colour = LATITUDE, fill=LATITUDE)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 2, raw=TRUE), alpha=0.3) + facet_grid(~LATIN_GENUS) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/cs-initial-plots-3-1.png)<!-- -->

### CS v TEMPERATURE [GENUS]

```r
ggplot(CS.data, aes(x =temperature, y= CS_ACTIVITY, colour = LATIN_GENUS, fill=LATIN_GENUS)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 2, raw=TRUE), alpha=0.3) + facet_grid(~LATITUDE) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/cs-initial-plots-4-1.png)<!-- -->

### CS v TEMPERATURE [SPECIES]

```r
ggplot(CS.data, aes(x =temperature, y= CS_ACTIVITY, colour = species, fill= species)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 2, raw=TRUE), alpha=0.3) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/cs-initial-plots-5-1.png)<!-- -->

### CS v MASS [SPECIES]

```r
ggplot(CS.data, aes(x =MASS, y= CS_ACTIVITY, colour = species, fill= species)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE, alpha=0.3) + theme_classic() + facet_wrap(~temperature)
```

![](01.DataAnalysis_files/figure-html/cs-initial-plots-6-1.png)<!-- -->

### {-} 

## Fit the model 

The model was fit using the **glm** and later **glmmTMB** package in R. A number of different models were tested to determine which hypothesis and associated variables best predicted resting oxygen consumption. Model fit was examined using AICc, BIC, and r-squared values. Additional model were examined via the validation diagnostics provided by the **performance** and **dHARMA** packages in R.

From out initial plots we can see that our data is heavily skewed to the right. From our initial plots we can all see that the relationship between enzyme activity and temperature is no linear, but rather may represent either a quadratic or cubic relationship. Let's start out model selection process by comparing different polynomial models.  

### polynomial models

```r
#--- model 1 ---# 
cs.model.1 <- glm(CS_ACTIVITY ~ temperature * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = CS.data) 

cs.model.1.p2 <- glm(CS_ACTIVITY ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = CS.data)  

cs.model.1.p3 <- glm(CS_ACTIVITY ~ poly(temperature, 3) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = CS.data) 
```

#### model comparisons - polynomial models 

```r
aic.c=AICc(cs.model.1, cs.model.1.p2, cs.model.1.p3, k=3) 
bic=BIC(cs.model.1, cs.model.1.p2, cs.model.1.p3)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredLR(cs.model.1)[1], r.squaredLR(cs.model.1.p2)[1], r.squaredLR(cs.model.1.p3)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cs.model.1 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 724.0791 </td>
   <td style="text-align:right;"> 742.3454 </td>
   <td style="text-align:right;"> 0.7454243 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 718.2736 </td>
   <td style="text-align:right;"> 743.6757 </td>
   <td style="text-align:right;"> 0.7712719 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cs.model.1.p3 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;"> 732.5049 </td>
   <td style="text-align:right;"> 764.3754 </td>
   <td style="text-align:right;"> 0.7714180 </td>
  </tr>
</tbody>
</table>

```r
anova(cs.model.1, cs.model.1.p2, cs.model.1.p3, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Resid. Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Resid. Dev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"174","2":"486.6812","3":"NA","4":"NA","5":"NA","_rn_":"1"},{"1":"170","2":"437.2674","3":"4","4":"49.4138290","5":"0.0008716871","_rn_":"2"},{"1":"166","2":"436.9882","3":"4","4":"0.2792615","5":"0.9986420437","_rn_":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

Looks like the model where temperature is treated as a second order polynomial (quadratic model) is better than the and third order polynomial model. Lets see if adding the variable **tissue.mass** improves the model. 

### fixed factor comparisons

```r
#--- model 1 ---# 
cs.model.1.p2 <- glm(CS_ACTIVITY ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = CS.data)  

cs.model.1.p2b <- cs.model.1 %>% update(. ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + scale(tissue_mass))

cs.model.1.p2c <- cs.model.1 %>% update(. ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + scale(MASS))

cs.model.1.p2d <- cs.model.1 %>% update(. ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + scale(MASS)*scale(tissue_mass))
```

#### model comparisons - fixed factor comparisons 

```r
aic.c=AICc(cs.model.1.p2, cs.model.1.p2b,cs.model.1.p2c, cs.model.1.p2d, k=4) 
bic=BIC(cs.model.1.p2, cs.model.1.p2b,cs.model.1.p2c, cs.model.1.p2d)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredLR(cs.model.1.p2)[1], r.squaredLR(cs.model.1.p2b)[1],r.squaredLR(cs.model.1.p2c)[1], r.squaredLR(cs.model.1.p2d)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 732.3569 </td>
   <td style="text-align:right;"> 743.6757 </td>
   <td style="text-align:right;"> 0.7712719 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2b </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 736.5860 </td>
   <td style="text-align:right;"> 748.4121 </td>
   <td style="text-align:right;"> 0.7718588 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2c </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 736.9237 </td>
   <td style="text-align:right;"> 748.7498 </td>
   <td style="text-align:right;"> 0.7714350 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2d </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 734.5104 </td>
   <td style="text-align:right;"> 747.1806 </td>
   <td style="text-align:right;"> 0.7859925 </td>
  </tr>
</tbody>
</table>

```r
anova(cs.model.1.p2, cs.model.1.p2b,cs.model.1.p2, cs.model.1.p2b,cs.model.1.p2c, cs.model.1.p2d, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Resid. Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Resid. Dev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"170","2":"437.2674","3":"NA","4":"NA","5":"NA","_rn_":"1"},{"1":"169","2":"436.1455","3":"1","4":"1.1219084","5":"0.49858403","_rn_":"2"},{"1":"170","2":"437.2674","3":"-1","4":"-1.1219084","5":"0.49858403","_rn_":"3"},{"1":"169","2":"436.1455","3":"1","4":"1.1219084","5":"0.49858403","_rn_":"4"},{"1":"169","2":"436.9556","3":"0","4":"-0.8100611","5":"NA","_rn_":"5"},{"1":"167","2":"409.1256","3":"2","4":"27.8299652","5":"0.00341382","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

The variable **TISSUE_MASS_CENTERED does not** improve the model nor is there any significant difference the models, therefore it will be left out of the model moving forward. 

Lastly, because tissue samples from the same fish were tested at multiple temperatures we need to include **fish_id** as a random factor. 

### Generalised linear mixed model (GLMM)

```r
cs.model.1.p2 <- glmmTMB(CS_ACTIVITY ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + (1|fish_id), 
               family = gaussian(),
               REML = TRUE,
               data = CS.data) 
```

Great! Now lets check our model validations to see how the model is performing. 

## Model validation {.tabset}

### cs.model.1 [performance]


```r
cs.model.1.p2 %>% check_model(detrend = FALSE)
```

![](01.DataAnalysis_files/figure-html/cs-model-validatiaon-1-1.png)<!-- -->

### cs.model.1 [DHARMa]


```r
cs.model.1.p2 %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/cs-model-validatiaon-2-1.png)<!-- -->

```
Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
 
Scaled residual values: 0.504 0.4 0.536 0.428 0.376 0.328 0.168 0.076 0.02 0.368 0.296 0.34 0.256 0.12 0.676 0.66 0.856 0.964 0.408 0.276 ...
```

```r
cs.model.1.p2 %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/cs-model-validatiaon-2-2.png)<!-- -->

```
$uniformity

	Asymptotic one-sample Kolmogorov-Smirnov test

data:  simulationOutput$scaledResiduals
D = 0.1018, p-value = 0.04599
alternative hypothesis: two-sided


$dispersion

	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
	simulated

data:  simulationOutput
dispersion = 0.93041, p-value = 0.584
alternative hypothesis: two.sided


$outliers

	DHARMa outlier test based on exact binomial test with approximate
	expectations

data:  simulationOutput
outliers at both margin(s) = 1, observations = 182, p-value = 1
alternative hypothesis: true probability of success is not equal to 0.007968127
95 percent confidence interval:
 0.0001390992 0.0302316908
sample estimates:
frequency of outliers (expected: 0.00796812749003984 ) 
                                           0.005494505 
```

```
$uniformity

	Asymptotic one-sample Kolmogorov-Smirnov test

data:  simulationOutput$scaledResiduals
D = 0.1018, p-value = 0.04599
alternative hypothesis: two-sided


$dispersion

	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
	simulated

data:  simulationOutput
dispersion = 0.93041, p-value = 0.584
alternative hypothesis: two.sided


$outliers

	DHARMa outlier test based on exact binomial test with approximate
	expectations

data:  simulationOutput
outliers at both margin(s) = 1, observations = 182, p-value = 1
alternative hypothesis: true probability of success is not equal to 0.007968127
95 percent confidence interval:
 0.0001390992 0.0302316908
sample estimates:
frequency of outliers (expected: 0.00796812749003984 ) 
                                           0.005494505 
```

### cs.model.1 [plot model]

```r
par(mar=c(2,2,2,2))
cs.model.1.p2 %>% plot_model(type = "diag")
```

```
[[1]]
```

```

[[2]]
[[2]]$fish_id
```

```


[[3]]
```

```

[[4]]
```


<img src="01.DataAnalysis_files/figure-html/cs-model-validatiaon-3-1.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/cs-model-validatiaon-3-2.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/cs-model-validatiaon-3-3.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/cs-model-validatiaon-3-4.png" width="50%" />

Issues that come up with the model are the KS test provided by the DHARMa checks and we also see some of the lower values drop off on the qq-plot provided by the 'check_model' function. Let's see if we can fix some of this issues by changing the link function within our distributions. 

### {-}

## Re-fitting model 

Turn **REML** off when comparing models

### re-fitting models [link functions]


```r
cs.model.1.p2 <-  cs.model.1.p2 %>% update(REML = FALSE)
cs.model.1.p2.log <- cs.model.1.p2 %>% update(family=gaussian(link="log"), 
                                              REML=FALSE) 
cs.model.1.p2.sqrt <- cs.model.1.p2 %>% update(family=gaussian(link="sqrt"), 
                                               REML=FALSE) 
```

### re-fit model comparisons [link function]


```r
aic.c=AICc(cs.model.1.p2, cs.model.1.p2.log, cs.model.1.p2.sqrt,  k=4) 
bic=BIC(cs.model.1.p2, cs.model.1.p2.log, cs.model.1.p2.sqrt)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredGLMM(cs.model.1.p2)[1], r.squaredGLMM(cs.model.1.p2.log)[1], r.squaredGLMM(cs.model.1.p2.sqrt)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 642.8919 </td>
   <td style="text-align:right;"> 654.7181 </td>
   <td style="text-align:right;"> 0.7729074 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2.log </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 433.1117 </td>
   <td style="text-align:right;"> 444.9378 </td>
   <td style="text-align:right;"> 0.6636456 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cs.model.1.p2.sqrt </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 484.7479 </td>
   <td style="text-align:right;"> 496.5741 </td>
   <td style="text-align:right;"> 0.5671737 </td>
  </tr>
</tbody>
</table>

```r
anova(cs.model.1.p2, cs.model.1.p2.log, cs.model.1.p2.sqrt, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Chisq"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Chi Df"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"14","2":"609.8620","3":"654.7181","4":"-290.9310","5":"581.8620","6":"NA","7":"NA","8":"NA","_rn_":"cs.model.1.p2"},{"1":"14","2":"400.0817","3":"444.9378","4":"-186.0409","5":"372.0817","6":"209.7802","7":"0","8":"0","_rn_":"cs.model.1.p2.log"},{"1":"14","2":"451.7180","3":"496.5741","4":"-211.8590","5":"423.7180","6":"0.0000","7":"0","8":"1","_rn_":"cs.model.1.p2.sqrt"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

From this model comparison it looks like the model that uses the **log** link function helps improve our model. Lets see how the model validation looks. We will run the model one more time with **REML=TRUE** before looking at model validation outputs. 


```r
cs.model.1.p2.log <- cs.model.1.p2.log %>% update(REML = TRUE)
```

## Model re-validation {.tabset}

### cs.model.1.p2.log [performance]


```r
cs.model.1.p2.log %>% check_model(detrend=FALSE)
```

![](01.DataAnalysis_files/figure-html/cs-model-re-validatiaon-1-1.png)<!-- -->

### cs.model.1.p2.log [DHARMa]


```r
cs.model.1.p2.log %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/cs-model-re-validatiaon-2-1.png)<!-- -->

```
## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.58 0.408 0.624 0.532 0.184 0.156 0.04 0.052 0.012 0.232 0.128 0.236 0.232 0.2 0.892 0.76 0.86 0.888 0.312 0.132 ...
```

```r
cs.model.1.p2.log %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/cs-model-re-validatiaon-2-2.png)<!-- -->

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.031604, p-value = 0.9934
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.64449, p-value = 0.24
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 182, p-value = 0.4114
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00000000 0.02006454
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.031604, p-value = 0.9934
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.64449, p-value = 0.24
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 182, p-value = 0.4114
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00000000 0.02006454
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

### cs.model.1.p2.log [plot_model]

```r
par(mar=c(2,2,2,2))
cs.model.1.p2.log %>% plot_model(type = "diag")
```

```
## [[1]]
```

```
## 
## [[2]]
## [[2]]$fish_id
```

```
## 
## 
## [[3]]
```

```
## 
## [[4]]
```


<img src="01.DataAnalysis_files/figure-html/cs-model-re-validatiaon-3-1.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/cs-model-re-validatiaon-3-2.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/cs-model-re-validatiaon-3-3.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/cs-model-re-validatiaon-3-4.png" width="50%" />
### {-}

Model looks much better, there are still some issues with qq plot output from the **plot_model** validations, but otherwise the model looks like it is performing really well. Considering how well the model is performing across most metrics, the current model is judged to be suitable.  

## Partial plots {.tabset} 

### ggemmeans {.tabset} 

#### TEMPERATURE V LATITUDE

![](01.DataAnalysis_files/figure-html/cs-partial-plots-1-1.png)<!-- -->

#### TEMPERATURE V GENUS

![](01.DataAnalysis_files/figure-html/cs-partial-plots-1b-1.png)<!-- -->

#### TEMPERATURE V GENUS V LATITUDE

![](01.DataAnalysis_files/figure-html/cs-partial-plots-1c-1.png)<!-- -->

### plot_model 

![](01.DataAnalysis_files/figure-html/cs-partial-plots-1d-1.png)<!-- -->

#### {-}

### {-}

## Model investigation {.tabset .tabset-pills}

### summary 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Estimate </th>
   <th style="text-align:right;"> StdError </th>
   <th style="text-align:right;"> Zvalue </th>
   <th style="text-align:right;"> Pvalue </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 0.7510157 </td>
   <td style="text-align:right;"> 0.1319696 </td>
   <td style="text-align:right;"> 5.6908219 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1 </td>
   <td style="text-align:right;"> 9.6202701 </td>
   <td style="text-align:right;"> 0.6988145 </td>
   <td style="text-align:right;"> 13.7665575 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2 </td>
   <td style="text-align:right;"> -1.0934659 </td>
   <td style="text-align:right;"> 0.4390221 </td>
   <td style="text-align:right;"> -2.4906851 </td>
   <td style="text-align:right;"> 0.0127497 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical </td>
   <td style="text-align:right;"> -0.0050903 </td>
   <td style="text-align:right;"> 0.1825669 </td>
   <td style="text-align:right;"> -0.0278821 </td>
   <td style="text-align:right;"> 0.9777562 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.4596728 </td>
   <td style="text-align:right;"> 0.1830279 </td>
   <td style="text-align:right;"> 2.5114903 </td>
   <td style="text-align:right;"> 0.0120223 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical </td>
   <td style="text-align:right;"> 0.1406210 </td>
   <td style="text-align:right;"> 0.9959936 </td>
   <td style="text-align:right;"> 0.1411867 </td>
   <td style="text-align:right;"> 0.8877225 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical </td>
   <td style="text-align:right;"> 0.3232856 </td>
   <td style="text-align:right;"> 0.6236875 </td>
   <td style="text-align:right;"> 0.5183454 </td>
   <td style="text-align:right;"> 0.6042173 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.0840327 </td>
   <td style="text-align:right;"> 0.8357926 </td>
   <td style="text-align:right;"> 0.1005425 </td>
   <td style="text-align:right;"> 0.9199137 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.1439155 </td>
   <td style="text-align:right;"> 0.5273767 </td>
   <td style="text-align:right;"> 0.2728894 </td>
   <td style="text-align:right;"> 0.7849382 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.2098695 </td>
   <td style="text-align:right;"> 0.2523627 </td>
   <td style="text-align:right;"> 0.8316189 </td>
   <td style="text-align:right;"> 0.4056241 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.4993366 </td>
   <td style="text-align:right;"> 1.1607065 </td>
   <td style="text-align:right;"> 0.4302006 </td>
   <td style="text-align:right;"> 0.6670498 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -0.6159270 </td>
   <td style="text-align:right;"> 0.7279050 </td>
   <td style="text-align:right;"> -0.8461640 </td>
   <td style="text-align:right;"> 0.3974613 </td>
  </tr>
</tbody>
</table>

### anova 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Chisq </th>
   <th style="text-align:right;"> Df </th>
   <th style="text-align:right;"> Pr(&gt;Chisq) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2) </td>
   <td style="text-align:right;"> 3424.6394812 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDE </td>
   <td style="text-align:right;"> 1.1218967 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.2895104 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUS </td>
   <td style="text-align:right;"> 23.4811359 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0000013 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATITUDE </td>
   <td style="text-align:right;"> 1.4404598 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.4866404 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATIN_GENUS </td>
   <td style="text-align:right;"> 0.3536138 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.8379416 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDE:LATIN_GENUS </td>
   <td style="text-align:right;"> 0.8750029 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.3495740 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATITUDE:LATIN_GENUS </td>
   <td style="text-align:right;"> 0.8990948 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.6379168 </td>
  </tr>
</tbody>
</table>

### confint 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> 2.5 % </th>
   <th style="text-align:right;"> 97.5 % </th>
   <th style="text-align:right;"> Estimate </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 0.4923600 </td>
   <td style="text-align:right;"> 1.0096715 </td>
   <td style="text-align:right;"> 0.7510157 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1 </td>
   <td style="text-align:right;"> 8.2506188 </td>
   <td style="text-align:right;"> 10.9899214 </td>
   <td style="text-align:right;"> 9.6202701 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2 </td>
   <td style="text-align:right;"> -1.9539334 </td>
   <td style="text-align:right;"> -0.2329983 </td>
   <td style="text-align:right;"> -1.0934659 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical </td>
   <td style="text-align:right;"> -0.3629149 </td>
   <td style="text-align:right;"> 0.3527342 </td>
   <td style="text-align:right;"> -0.0050903 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.1009447 </td>
   <td style="text-align:right;"> 0.8184008 </td>
   <td style="text-align:right;"> 0.4596728 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical </td>
   <td style="text-align:right;"> -1.8114906 </td>
   <td style="text-align:right;"> 2.0927326 </td>
   <td style="text-align:right;"> 0.1406210 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical </td>
   <td style="text-align:right;"> -0.8991195 </td>
   <td style="text-align:right;"> 1.5456907 </td>
   <td style="text-align:right;"> 0.3232856 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -1.5540907 </td>
   <td style="text-align:right;"> 1.7221560 </td>
   <td style="text-align:right;"> 0.0840327 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -0.8897238 </td>
   <td style="text-align:right;"> 1.1775549 </td>
   <td style="text-align:right;"> 0.1439155 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -0.2847522 </td>
   <td style="text-align:right;"> 0.7044913 </td>
   <td style="text-align:right;"> 0.2098695 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -1.7756064 </td>
   <td style="text-align:right;"> 2.7742795 </td>
   <td style="text-align:right;"> 0.4993366 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -2.0425946 </td>
   <td style="text-align:right;"> 0.8107406 </td>
   <td style="text-align:right;"> -0.6159270 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Std.Dev.(Intercept)|fish_id </td>
   <td style="text-align:right;"> 0.2874426 </td>
   <td style="text-align:right;"> 0.4755286 </td>
   <td style="text-align:right;"> 0.3697123 </td>
  </tr>
</tbody>
</table>

### r-squared
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:right;"> R2_conditional </th>
   <th style="text-align:right;"> R2_marginal </th>
   <th style="text-align:left;"> optional </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.7858256 </td>
   <td style="text-align:right;"> 0.6449892 </td>
   <td style="text-align:left;"> FALSE </td>
  </tr>
</tbody>
</table>

### {-} 

## Pairwise comparisons {.tabset .tabset-faded} 

### emtrends 


```r
cs.model.1.p2.log %>% emtrends(var = "temperature", type = "response") %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["t.ratio"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"(sub-tropical Apogon) - tropical Apogon","2":"30.38462","3":"-0.0008574003","4":"0.005046098","5":"180","6":"-0.01428148","7":"0.012566681","8":"-0.16991354","9":"0.9999940","_rn_":"1"},{"1":"(sub-tropical Apogon) - (sub-tropical Pomacentrus)","2":"30.38462","3":"-0.0004942210","4":"0.004233905","5":"180","6":"-0.01175763","7":"0.010769191","8":"-0.11672936","9":"0.9999994","_rn_":"2"},{"1":"(sub-tropical Apogon) - tropical Pomacentrus","2":"30.38462","3":"-0.0037466016","4":"0.004031832","5":"180","6":"-0.01447244","7":"0.006979240","8":"-0.92925527","9":"0.9273242","_rn_":"3"},{"1":"tropical Apogon - (sub-tropical Pomacentrus)","2":"30.38462","3":"0.0003631793","4":"0.004280310","5":"180","6":"-0.01102368","7":"0.011750043","8":"0.08484884","9":"0.9999999","_rn_":"4"},{"1":"tropical Apogon - tropical Pomacentrus","2":"30.38462","3":"-0.0028892012","4":"0.004080552","5":"180","6":"-0.01374465","7":"0.007966248","8":"-0.70804182","9":"0.9801917","_rn_":"5"},{"1":"(sub-tropical Pomacentrus) - tropical Pomacentrus","2":"30.38462","3":"-0.0032523806","4":"0.003018825","5":"180","6":"-0.01128333","7":"0.004778568","8":"-1.07736637","9":"0.8638578","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
SCROLL TO THE RIGHT -->

The numbers in the left most column in the table just mention that the slopes are assuming mean **MASS_CENTERED** and **RESTING_TIME_SEONDS** values when looking at differences between latitudinal slopes.

### emmeans 

```r
cs.model.1.p2.log %>% emmeans(pairwise ~ temperature*LATITUDE*LATIN_GENUS, type = "response") %>% regrid() %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["t.ratio"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"(sub-tropical Apogon) - tropical Apogon","2":"30.38462","3":"0.07681331","4":"0.4111760","5":"180","6":"-1.017034","7":"1.17066055","8":"0.1868137","9":"0.999989498","_rn_":"1"},{"1":"(sub-tropical Apogon) - (sub-tropical Pomacentrus)","2":"30.38462","3":"-1.31489405","4":"0.5501255","5":"180","6":"-2.778387","7":"0.14859920","8":"-2.3901709","9":"0.102558089","_rn_":"2"},{"1":"(sub-tropical Apogon) - tropical Pomacentrus","2":"30.38462","3":"-2.26037978","4":"0.6230814","5":"180","6":"-3.917957","7":"-0.60280288","8":"-3.6277441","9":"0.002231365","_rn_":"3"},{"1":"tropical Apogon - (sub-tropical Pomacentrus)","2":"30.38462","3":"-1.39170736","4":"0.5372040","5":"180","6":"-2.820826","7":"0.03741081","8":"-2.5906498","9":"0.060597802","_rn_":"4"},{"1":"tropical Apogon - tropical Pomacentrus","2":"30.38462","3":"-2.33719309","4":"0.6116965","5":"180","6":"-3.964483","7":"-0.70990330","8":"-3.8208379","9":"0.001097362","_rn_":"5"},{"1":"(sub-tropical Pomacentrus) - tropical Pomacentrus","2":"30.38462","3":"-0.94548573","4":"0.7125158","5":"180","6":"-2.840984","7":"0.95001270","8":"-1.3269681","9":"0.709526935","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### temperature 

```r
cs.model.1.p2.log %>% emmeans(~ temperature*LATITUDE*LATIN_GENUS, type = "response")  %>% summary(infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["temperature"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["LATITUDE"],"name":[2],"type":["fct"],"align":["left"]},{"label":["LATIN_GENUS"],"name":[3],"type":["fct"],"align":["left"]},{"label":["response"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["null"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["t.ratio"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"30.38462","2":"sub-tropical","3":"Apogon","4":"2.332751","5":"0.3027074","6":"180","7":"1.805782","8":"3.013502","9":"1","10":"6.527597","11":"6.587921e-10","_rn_":"1"},{"1":"30.38462","2":"tropical","3":"Apogon","4":"2.255938","5":"0.2785132","6":"180","7":"1.768187","8":"2.878233","9":"1","10":"6.589824","11":"4.704735e-10","_rn_":"2"},{"1":"30.38462","2":"sub-tropical","3":"Pomacentrus","4":"3.647645","5":"0.4594195","6":"180","7":"2.844974","8":"4.676778","9":"1","10":"10.274598","11":"8.842322e-20","_rn_":"3"},{"1":"30.38462","2":"tropical","3":"Pomacentrus","4":"4.593131","5":"0.5446284","6":"180","7":"3.634919","8":"5.803939","9":"1","10":"12.857412","11":"2.927177e-27","_rn_":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### temperture [combined]

```r
cs.means.temp <- cs.model.1.p2.log %>% update(CS_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature, type = "response") %>% summary(infer=TRUE)
```

```
## NOTE: Results may be misleading due to involvement in interactions
```

```r
cs.means.temp.df <- cs.means.temp$emmeans %>% as.data.frame() %>% 
  mutate("\u394 change"=response - lag(response, n=1, default = first(response)), 
         "\u394 %change" = response/lag(response, n=1, default = first(response))*100) 
cs.means.temp.df[1,11] = 0.0000 


cs.means.temp.df  
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["temperature"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["response"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["null"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["t.ratio"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[9],"type":["dbl"],"align":["right"]},{"label":[" change"],"name":[10],"type":["dbl"],"align":["right"]},{"label":[" %change"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"10","2":"0.8770465","3":"0.09412851","4":"180","5":"0.7096587","6":"1.083916","7":"1","8":"-1.222418","9":"2.231479e-01","10":"0.0000000","11":"0.0000","_rn_":"1"},{"1":"20","2":"1.7542386","3":"0.12986028","4":"180","5":"1.5158304","6":"2.030143","7":"1","8":"7.592339","9":"1.641724e-12","10":"0.8771921","11":"200.0166","_rn_":"2"},{"1":"30","2":"2.9311410","3":"0.19119795","4":"180","5":"2.5771346","6":"3.333775","7":"1","8":"16.486186","9":"8.172245e-38","10":"1.1769024","11":"167.0891","_rn_":"3"},{"1":"40","2":"4.8622314","3":"0.30268797","4":"180","5":"4.3001854","6":"5.497738","7":"1","8":"25.404402","9":"2.004269e-61","10":"1.9310904","11":"165.8819","_rn_":"4"},{"1":"50","2":"7.0603653","3":"0.43383401","4":"180","5":"6.2541727","6":"7.970480","7":"1","8":"31.808160","9":"8.441080e-76","10":"2.1981339","11":"145.2083","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### Genus values [combined]

```r
cs.genus.df <- cs.model.1.p2.log %>% update(CS_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS, type = "response"); cs.genus.df$emmeans
```

```
## NOTE: Results may be misleading due to involvement in interactions
```

```
##  temperature LATIN_GENUS response    SE  df lower.CL upper.CL
##           10 Apogon         0.642 0.115 180    0.450    0.915
##           20 Apogon         1.388 0.155 180    1.114    1.730
##           30 Apogon         2.160 0.207 180    1.788    2.608
##           40 Apogon         3.633 0.325 180    3.045    4.335
##           50 Apogon         5.269 0.463 180    4.430    6.267
##           10 Pomacentrus    1.198 0.140 180    0.951    1.510
##           20 Pomacentrus    2.217 0.216 180    1.830    2.686
##           30 Pomacentrus    3.978 0.353 180    3.340    4.739
##           40 Pomacentrus    6.507 0.563 180    5.485    7.718
##           50 Pomacentrus    9.461 0.812 180    7.987   11.208
## 
## Results are averaged over the levels of: LATITUDE 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale
```

### Genus ratios [combined]

```r
cs.model.1.p2.log %>% update(CS_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS, type = "response") %>% pairs(by="temperature") %>% summary(infer=FALSE)
```

```
## NOTE: Results may be misleading due to involvement in interactions
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["fct"],"align":["left"]},{"label":["ratio"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"Apogon / Pomacentrus","2":"10","3":"0.5358345","4":"0.11500546","5":"180","_rn_":"1"},{"1":"Apogon / Pomacentrus","2":"20","3":"0.6261699","4":"0.09268900","5":"180","_rn_":"2"},{"1":"Apogon / Pomacentrus","2":"30","3":"0.5428289","4":"0.07079910","5":"180","_rn_":"3"},{"1":"Apogon / Pomacentrus","2":"40","3":"0.5583970","4":"0.06950390","5":"180","_rn_":"4"},{"1":"Apogon / Pomacentrus","2":"50","3":"0.5568480","4":"0.06840868","5":"180","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### Genus differences [combined]

```r
cs.model.1.p2.log %>% update(CS_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS, type = "response") %>% regrid() %>% pairs(by="temperature") %>% summary(infer=FALSE)
```

```
## NOTE: Results may be misleading due to involvement in interactions
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"Apogon - Pomacentrus","2":"10","3":"-0.5561348","4":"0.1817808","5":"180","_rn_":"1"},{"1":"Apogon - Pomacentrus","2":"20","3":"-0.8287372","4":"0.2654446","5":"180","_rn_":"2"},{"1":"Apogon - Pomacentrus","2":"30","3":"-1.8187959","4":"0.4086915","5":"180","_rn_":"3"},{"1":"Apogon - Pomacentrus","2":"40","3":"-2.8733999","4":"0.6501203","5":"180","_rn_":"4"},{"1":"Apogon - Pomacentrus","2":"50","3":"-4.1928713","4":"0.9348894","5":"180","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### Means - f(temperature)

```r
cs.means <- cs.model.1.p2.log %>% update(CS_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response"); cs.means$emmeans
```

### Abs. diff - f(temperature)

```r
cs.model.1.p2.log %>% update(CS_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response") %>% regrid() %>% pairs(by =c("LATIN_GENUS","LATITUDE")) %>% summary(infer=FALSE, type = "response")
```

### Genus comparisons

```r
cs.model.1.p2.log %>% update(CS_ACTIVITY ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response") %>% regrid() %>% pairs(by =c("LATIN_GENUS")) %>% summary(infer=TRUE, type = "response")
```

### effect size

```r
cs.emm <- cs.model.1.p2.log %>% emmeans(~temperature*LATITUDE*LATIN_GENUS)
eff_size(cs.emm, sigma = sigma(cs.model.1.p2.log), edf=df.residual(cs.model.1.p2.log))
```

### {-}

## Summary figure 



```r
cs.emm <- emmeans(cs.model.1.p2.log, ~temperature|LATITUDE|LATIN_GENUS, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") 

cs.emm.df <- cs.emm %>% as.data.frame() %>%
  unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 

cs.obs <-  CS.data %>% 
  mutate(Pred=exp(predict(cs.model.1.p2.log, re.form=NA)),
         Resid = residuals(cs.model.1.p2.log,  type="response"),
         Fit = Pred + Resid) %>%
   unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 


cs.plot <- ggplot(cs.emm.df, aes(y=response, x=temperature, linetype=species, color = species, fill=species))+
  geom_jitter(data=cs.obs, 
              aes(y=Fit, color = species), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= lower.CL, ymax= upper.CL),
              alpha = 0.2, 
              color=NA)+ 
  #scale_x_continuous(limits = c(9, 52), 
                     #breaks = seq(10, 52, by = 10))+ 
  #scale_y_continuous(limits = c(0,16), breaks = seq(0, 16, by = 2)) +
  theme_classic() + 
  ylab(expression("CS ACTIVITY (U mg "^{-1} * "tissue)")) + 
  xlab("")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis"))+
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +  
  theme(legend.position = "top", 
        legend.text = element_text(size = 10), 
        legend.title = element_blank(), 
        axis.title = element_text(size =12), 
        axis.text = element_text(size=10)); cs.plot
```

![](01.DataAnalysis_files/figure-html/cs-sum-fig-1.png)<!-- -->

## Arrhenius plot 

```r
cs.arrhenius.plot <- ggplot(cs.emm.df, aes(y=log(response), x=1/(temperature+273.15), linetype=species, color = species, fill=species))+
  geom_jitter(data=cs.obs, 
              aes(y=log(Fit), color = species), 
              #width=0.005, 
              alpha = 0.3, 
              size = 2) +
  stat_poly_line(method="lm", se = TRUE) + 
  stat_poly_eq(use_label(c("eq", "R2")), hjust = -1.6)+
  #geom_ribbon(aes(x=1/(temperature+273.15), 
              #ymin= log(asymp.LCL), ymax= log(asymp.UCL)),
              #alpha = 0.2, 
              #color=NA)+ 
  #scale_x_continuous(limits = c(9, 52), 
                     #breaks = seq(10, 52, by = 10))+ 
  #scale_y_continuous(limits = c(0,120), breaks = seq(0, 120, by = 20)) +
  theme_classic() + 
  ylab(expression("log(CS (U mg "^{-1} * "tissue))")) + 
  xlab("")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis"))+
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +  
  theme(legend.position = "top", 
        legend.text = element_text(size = 10), 
        legend.title = element_blank(), 
        axis.title = element_text(size =12), 
        axis.text = element_text(size=10)); cs.arrhenius.plot
```

![](01.DataAnalysis_files/figure-html/cs-arrhenius plot-1.png)<!-- -->
 
# CS:LDH ratio 

## Merge dataframes 

To start we will merge the lactate dehydrogenase (LDH) and citrate synthase (CS) dataframes


```r
lc.data <- CS.data |> 
  left_join(select(ldh.data, c("UNIQUE_SAMPLE_ID","LDH_ACTIVITY")), by = "UNIQUE_SAMPLE_ID") |> 
  mutate(LDHCS = LDH_ACTIVITY/CS_ACTIVITY) |> 
  drop_na(LDHCS)
```

## Initial plot {.tabset}

### LDH:CS v TEMPERATURE [SPECIES]


```r
ggplot(lc.data, aes(x =temperature, y= LDHCS, color = species)) + 
  geom_point() + 
  stat_smooth(method = "lm", se=FALSE) + 
  theme_classic() 
```

![](01.DataAnalysis_files/figure-html/lcr-initial-plots-1.png)<!-- -->

### LDH:CS [distribution]

```r
ggplot(lc.data, aes(x = LDHCS, fill = temperature, color = temperature)) + 
  geom_density(alpha =0.5, position = "identity") 
```

![](01.DataAnalysis_files/figure-html/lcr-initial-plots-2-1.png)<!-- -->

```r
ggplot(lc.data, aes(x=LDHCS)) + geom_histogram()
```

![](01.DataAnalysis_files/figure-html/lcr-initial-plots-2-2.png)<!-- -->

### LDH:CS v TEMPERATURE [LATITUDE]

```r
ggplot(lc.data, aes(x =temperature, y= LDHCS, colour = LATITUDE, fill=LATITUDE)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 2, raw=TRUE), alpha=0.3) + facet_grid(~LATIN_GENUS) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/lcr-initial-plots-3-1.png)<!-- -->

### LDH:CS v TEMPERATURE [GENUS]

```r
ggplot(lc.data, aes(x =temperature, y= LDHCS, colour = LATIN_GENUS, fill=LATIN_GENUS)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 2, raw=TRUE), alpha=0.3) + facet_grid(~LATITUDE) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/lcr-initial-plots-4-1.png)<!-- -->

### LDH:CS v TEMPERATURE [SPECIES]

```r
ggplot(lc.data, aes(x =temperature, y= LDHCS, colour = species, fill= species)) +   geom_point(alpha=0.3) + stat_smooth(method = "lm", se=TRUE,  formula=y ~ poly(x, 2, raw=TRUE), alpha=0.3) + theme_classic()
```

![](01.DataAnalysis_files/figure-html/lcr-initial-plots-5-1.png)<!-- -->

### {-} 

## Fit the model 

The model was fit using the **glm** and later **glmmTMB** packages in R. A number of different models were tested to determine which hypothesis and associated variables best predicted enzyme activity when measured as a ratio between lactate dehygronease and citrate synthase. Model fit was examined using AICc, BIC, and r-squared values. Additional model were examined via the validation diagnostics provided by the **performance**,**dHARMA**, and **plot_model** packages in R.

From out initial plots we can see that our data is heavily skewed to the right. From our initial plots we can all see that the relationship between enzyme activity (LDH:CS) and temperature is not linear, but rather may represent either a quadratic or cubic relationship. Let's start out model selection process by comparing different polynomial models.  

### polynomial models

```r
#--- model 1 ---# 
lc.model.1 <- glm(LDHCS ~ temperature * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = lc.data) 

lc.model.1.p2 <- glm(LDHCS ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = lc.data)  

lc.model.1.p3 <- glm(LDHCS ~ poly(temperature, 3) * LATITUDE * LATIN_GENUS, 
               family = gaussian(),
               data = lc.data) 
```

#### model comparisons - polynomial models 

```r
aic.c=AICc(lc.model.1, lc.model.1.p2, lc.model.1.p3, k=2) 
bic=BIC(lc.model.1, lc.model.1.p2, lc.model.1.p3)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredLR(lc.model.1)[1], r.squaredLR(lc.model.1.p2)[1], r.squaredLR(lc.model.1.p3)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> lc.model.1 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 1322.276 </td>
   <td style="text-align:right;"> 1349.552 </td>
   <td style="text-align:right;"> 0.6234160 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 1281.040 </td>
   <td style="text-align:right;"> 1319.743 </td>
   <td style="text-align:right;"> 0.7186253 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lc.model.1.p3 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;"> 1284.989 </td>
   <td style="text-align:right;"> 1334.647 </td>
   <td style="text-align:right;"> 0.7277605 </td>
  </tr>
</tbody>
</table>

```r
anova(lc.model.1, lc.model.1.p2, lc.model.1.p3, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Resid. Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Resid. Dev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"165","2":"18924.27","3":"NA","4":"NA","5":"NA","_rn_":"1"},{"1":"161","2":"14139.77","3":"4","4":"4784.5025","5":"3.398008e-11","_rn_":"2"},{"1":"157","2":"13680.70","3":"4","4":"459.0681","5":"2.608617e-01","_rn_":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

Looks like the model where temperature is treated as a second order polynomial (quadratic model) is better than the first and third order polynomial models. **Tissue mass** did not improve the model when looking at either lactate dehydrogenase or citrate synthase, therefore we will not be including it in the LDH:CS ratio analysis.

Because tissue samples from the same fish were tested at multiple temperatures we need to include **fish_id** as a random factor. 

### Generalised linear mixed model (GLMM)

```r
lc.model.1.p2 <- glmmTMB(LDHCS ~ poly(temperature, 2) * LATITUDE * LATIN_GENUS + (1|fish_id), 
               family = gaussian(),
               REML = TRUE,
               data = lc.data) 
```

Great! Now lets check our model validations to see how the model is performing. 

## Model validation {.tabset}

### lc.model.1 [performance]


```r
lc.model.1.p2 %>% check_model(detrend = FALSE)
```

![](01.DataAnalysis_files/figure-html/lcr-model-validatiaon-1-1.png)<!-- -->

### lc.model.1 [DHARMa]


```r
lc.model.1.p2 %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/lcr-model-validatiaon-2-1.png)<!-- -->

```
Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
 
Scaled residual values: 0.312 0.984 0.772 0.352 0.992 0.568 0.784 0.84 0.996 0.8 0.308 0.192 0.98 0.984 0.116 0.268 0.052 0 0.96 0.62 ...
```

```r
lc.model.1.p2 %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/lcr-model-validatiaon-2-2.png)<!-- -->

```
$uniformity

	Asymptotic one-sample Kolmogorov-Smirnov test

data:  simulationOutput$scaledResiduals
D = 0.16079, p-value = 0.0002608
alternative hypothesis: two-sided


$dispersion

	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
	simulated

data:  simulationOutput
dispersion = 0.90942, p-value = 0.64
alternative hypothesis: two.sided


$outliers

	DHARMa outlier test based on exact binomial test with approximate
	expectations

data:  simulationOutput
outliers at both margin(s) = 3, observations = 173, p-value = 0.1607
alternative hypothesis: true probability of success is not equal to 0.007968127
95 percent confidence interval:
 0.003590516 0.049839268
sample estimates:
frequency of outliers (expected: 0.00796812749003984 ) 
                                            0.01734104 
```

```
$uniformity

	Asymptotic one-sample Kolmogorov-Smirnov test

data:  simulationOutput$scaledResiduals
D = 0.16079, p-value = 0.0002608
alternative hypothesis: two-sided


$dispersion

	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
	simulated

data:  simulationOutput
dispersion = 0.90942, p-value = 0.64
alternative hypothesis: two.sided


$outliers

	DHARMa outlier test based on exact binomial test with approximate
	expectations

data:  simulationOutput
outliers at both margin(s) = 3, observations = 173, p-value = 0.1607
alternative hypothesis: true probability of success is not equal to 0.007968127
95 percent confidence interval:
 0.003590516 0.049839268
sample estimates:
frequency of outliers (expected: 0.00796812749003984 ) 
                                            0.01734104 
```

### lc.model.1 [plot model]

```r
par(mar=c(2,2,2,2))
lc.model.1.p2 %>% plot_model(type = "diag")
```

```
[[1]]
```

```

[[2]]
[[2]]$fish_id
```

```


[[3]]
```

```

[[4]]
```


<img src="01.DataAnalysis_files/figure-html/lcr-model-validatiaon-3-1.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/lcr-model-validatiaon-3-2.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/lcr-model-validatiaon-3-3.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/lcr-model-validatiaon-3-4.png" width="50%" />

Our initial model (gaussian distribution) does not seem to function well. The predictive model does not fit the observed data, and the qq-plot also does not do a good job of ensuring that sample quantiles fit within the expectations of a gaussian distribution. Unexpectedly there are a number of issues also brought up with the DHARMa checks, KS-test is significant, and so is the deviation of the model quantiles from thier expectations. Similar trends can found in the plot_model output as well. 

Lets start by changing the link distribution used within the model to see if this helps the model out.

### {-}

## Re-fitting model 

Turn **REML** off when comparing models

### re-fitting models [link functions]


```r
lc.model.1.p2 <-  lc.model.1.p2 %>% update(REML = FALSE)
lc.model.1.p2.log <- lc.model.1.p2 %>% update(family=gaussian(link="log"), 
                                              REML=FALSE) 
lc.model.1.p2.sqrt <- lc.model.1.p2 %>% update(family=gaussian(link="sqrt"), 
                                               REML=FALSE) 
```

### re-fit model comparisons [link function]


```r
aic.c=AICc(lc.model.1.p2, lc.model.1.p2.log, lc.model.1.p2.sqrt,  k=2) 
bic=BIC(lc.model.1.p2, lc.model.1.p2.log, lc.model.1.p2.sqrt)

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredGLMM(lc.model.1.p2)[1], r.squaredGLMM(lc.model.1.p2.log)[1], r.squaredGLMM(lc.model.1.p2.sqrt)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1241.877 </td>
   <td style="text-align:right;"> 1283.365 </td>
   <td style="text-align:right;"> 0.7204611 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2.log </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1186.484 </td>
   <td style="text-align:right;"> 1227.972 </td>
   <td style="text-align:right;"> 0.0146486 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2.sqrt </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1199.505 </td>
   <td style="text-align:right;"> 1240.992 </td>
   <td style="text-align:right;"> 0.0599157 </td>
  </tr>
</tbody>
</table>

```r
anova(lc.model.1.p2, lc.model.1.p2.log, lc.model.1.p2.sqrt, test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Chisq"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Chi Df"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"14","2":"1239.219","3":"1283.365","4":"-605.6096","5":"1211.219","6":"NA","7":"NA","8":"NA","_rn_":"lc.model.1.p2"},{"1":"14","2":"1183.826","3":"1227.972","4":"-577.9130","5":"1155.826","6":"55.39307","7":"0","8":"0","_rn_":"lc.model.1.p2.log"},{"1":"14","2":"1196.846","3":"1240.992","4":"-584.4232","5":"1168.846","6":"0.00000","7":"0","8":"1","_rn_":"lc.model.1.p2.sqrt"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

From our model outputs it looks like transforming the data via a log-link function seems to help. However, we will have to explore that data further as the r-squared value drops drastically

## Model re-validation {.tabset}


```r
lc.model.1.p2.log <- lc.model.1.p2.log %>% update(REML=TRUE)
```

### lc.model.1.p2.log [performance]


```r
lc.model.1.p2.log %>% check_model(detrend=FALSE)
```

![](01.DataAnalysis_files/figure-html/lc-model-re-validatiaon-1-1.png)<!-- -->

### lc.model.1.p2.log [DHARMa]


```r
lc.model.1.p2.log %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/lc-model-re-validatiaon-2-1.png)<!-- -->

```
## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.356 0.964 0.756 0.492 0.996 0.476 0.752 0.856 0.936 0.916 0.176 0.152 0.936 0.832 0.024 0.208 0.176 0.028 0.98 0.476 ...
```

```r
lc.model.1.p2.log %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/lc-model-re-validatiaon-2-2.png)<!-- -->

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.14342, p-value = 0.001622
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.98092, p-value = 0.84
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 173, p-value = 0.6518
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00000000 0.02109727
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.14342, p-value = 0.001622
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.98092, p-value = 0.84
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 173, p-value = 0.6518
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00000000 0.02109727
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

### lc.model.1.p2.log [plot_model]

```r
par(mar=c(2,2,2,2))
lc.model.1.p2.log %>% plot_model(type = "diag")
```

```
## [[1]]
```

```
## 
## [[2]]
## [[2]]$fish_id
```

```
## 
## 
## [[3]]
```

```
## 
## [[4]]
```


<img src="01.DataAnalysis_files/figure-html/lc-model-re-validatiaon-3-1.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/lc-model-re-validatiaon-3-2.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/lc-model-re-validatiaon-3-3.png" width="50%" /><img src="01.DataAnalysis_files/figure-html/lc-model-re-validatiaon-3-4.png" width="50%" />
### {-}

The log-link version of the model still has a number of issues, including a significant results for KS-test and quantile distributions, which shows that predicted data does not match the expected quantiles of a gaussian distribution and therefore violates assumptions within the gaussian distribution. 

Because out data is continuous and all positive we can try to see if a Gamma distribution does a better job at modelling the data. We can also try fitting a Gamma distribution with a log-link function as well (the default for gamma is 'inverse').

## Re-re-fitting model 

Turn **REML** off when comparing models

### re-fitting models [link functions]


```r
lc.model.1.p2 <-  lc.model.1.p2 %>% update(REML = FALSE)
lc.model.1.p2.log <-  lc.model.1.p2.log %>% update(REML = FALSE)
lc.model.1.p2.gamma <- lc.model.1.p2 %>% update(family=Gamma(), 
                                              REML=FALSE) 
lc.model.1.p2.gamma.log <- lc.model.1.p2 %>% update(family=Gamma(link="log"), 
                                              REML=FALSE)
```


```r
aic.c=AICc(lc.model.1.p2, lc.model.1.p2.log, lc.model.1.p2.gamma, lc.model.1.p2.gamma.log,   k=2) 
bic=BIC(lc.model.1.p2, lc.model.1.p2.log, lc.model.1.p2.gamma, lc.model.1.p2.gamma.log )

model.fit.table <- as.data.frame(aic.c) %>% 
  tibble::rownames_to_column("model") %>%
  mutate(BIC = bic$BIC, 
         r2 = c(r.squaredGLMM(lc.model.1.p2)[1], r.squaredGLMM(lc.model.1.p2.log)[1], r.squaredGLMM(lc.model.1.p2.gamma)[1], r.squaredGLMM(lc.model.1.p2.gamma.log)[1]))
model.fit.table %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> r2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1241.877 </td>
   <td style="text-align:right;"> 1283.365 </td>
   <td style="text-align:right;"> 0.7204611 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2.log </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1186.484 </td>
   <td style="text-align:right;"> 1227.972 </td>
   <td style="text-align:right;"> 0.0146486 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2.gamma </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.1047859 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lc.model.1.p2.gamma.log </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 1114.203 </td>
   <td style="text-align:right;"> 1155.691 </td>
   <td style="text-align:right;"> 0.7005747 </td>
  </tr>
</tbody>
</table>

```r
anova(lc.model.1.p2, lc.model.1.p2.log, lc.model.1.p2.gamma, lc.model.1.p2.gamma.log,  test = "Chisq")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Chisq"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Chi Df"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"14","2":"1239.219","3":"1283.365","4":"-605.6096","5":"1211.219","6":"NA","7":"NA","8":"NA","_rn_":"lc.model.1.p2"},{"1":"14","2":"1183.826","3":"1227.972","4":"-577.9130","5":"1155.826","6":"55.39307","7":"0","8":"0","_rn_":"lc.model.1.p2.log"},{"1":"14","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"0","8":"NA","_rn_":"lc.model.1.p2.gamma"},{"1":"14","2":"1111.544","3":"1155.691","4":"-541.7722","5":"1083.544","6":"NA","7":"0","8":"NA","_rn_":"lc.model.1.p2.gamma.log"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

The gamma model seems to help when using a log. Lets look at the model validation to see if it is an appropriate model to use. 

## Model re-re-validation {.tabset}

Turn REML on 


```r
lc.model.1.p2.gamma.log <- lc.model.1.p2.gamma.log %>% update(REML=TRUE) 
```

### [performance] 

#### lc.model.1.p2.gamma.log


```r
# lc.model.1.p2.gamma.log %>% check_model(detrend=FALSE)
```


### [DHARMa] 

#### lc.model.1.p2.gamma.log

```r
lc.model.1.p2.gamma.log %>% simulateResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/lc-model-re-32-validatiaon-1.2-1.png)<!-- -->

```
## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.324 0.96 0.768 0.428 0.984 0.632 0.844 0.888 0.804 0.844 0.244 0.308 0.928 0.696 0.008 0.348 0.32 0.064 0.976 0.688 ...
```

```r
lc.model.1.p2.gamma.log %>% DHARMa::testResiduals(plot=TRUE)
```

![](01.DataAnalysis_files/figure-html/lc-model-re-32-validatiaon-1.2-2.png)<!-- -->

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.054566, p-value = 0.6816
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.65625, p-value = 0.256
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 173, p-value = 0.6518
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00000000 0.02109727
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

```
## $uniformity
## 
## 	Asymptotic one-sample Kolmogorov-Smirnov test
## 
## data:  simulationOutput$scaledResiduals
## D = 0.054566, p-value = 0.6816
## alternative hypothesis: two-sided
## 
## 
## $dispersion
## 
## 	DHARMa nonparametric dispersion test via sd of residuals fitted vs.
## 	simulated
## 
## data:  simulationOutput
## dispersion = 0.65625, p-value = 0.256
## alternative hypothesis: two.sided
## 
## 
## $outliers
## 
## 	DHARMa outlier test based on exact binomial test with approximate
## 	expectations
## 
## data:  simulationOutput
## outliers at both margin(s) = 0, observations = 173, p-value = 0.6518
## alternative hypothesis: true probability of success is not equal to 0.007968127
## 95 percent confidence interval:
##  0.00000000 0.02109727
## sample estimates:
## frequency of outliers (expected: 0.00796812749003984 ) 
##                                                      0
```

### {-} 

This model does not violate any assumptions and therefore we can start to look at the results.  

## Partial plots {.tabset} 

### ggemmeans {.tabset} 

#### TEMPERATURE V LATITUDE

![](01.DataAnalysis_files/figure-html/lcr-partial-plots-1-1.png)<!-- -->

#### TEMPERATURE V GENUS

![](01.DataAnalysis_files/figure-html/lcr-partial-plots-1b-1.png)<!-- -->

#### TEMPERATURE V GENUS V LATITUDE

![](01.DataAnalysis_files/figure-html/lcr-partial-plots-1c-1.png)<!-- -->

### plot_model 

![](01.DataAnalysis_files/figure-html/lcr-partial-plots-1d-1.png)<!-- -->

#### {-}

### {-}

## Model investigation {.tabset .tabset-pills}

### summary 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Estimate </th>
   <th style="text-align:right;"> StdError </th>
   <th style="text-align:right;"> Zvalue </th>
   <th style="text-align:right;"> Pvalue </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 3.1918267 </td>
   <td style="text-align:right;"> 0.1110721 </td>
   <td style="text-align:right;"> 28.7365278 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1 </td>
   <td style="text-align:right;"> 7.4543468 </td>
   <td style="text-align:right;"> 0.8588077 </td>
   <td style="text-align:right;"> 8.6798786 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2 </td>
   <td style="text-align:right;"> 3.0191493 </td>
   <td style="text-align:right;"> 0.8487234 </td>
   <td style="text-align:right;"> 3.5572830 </td>
   <td style="text-align:right;"> 0.0003747 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical </td>
   <td style="text-align:right;"> -0.4893076 </td>
   <td style="text-align:right;"> 0.1533872 </td>
   <td style="text-align:right;"> -3.1900166 </td>
   <td style="text-align:right;"> 0.0014226 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -1.0388517 </td>
   <td style="text-align:right;"> 0.1667533 </td>
   <td style="text-align:right;"> -6.2298710 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical </td>
   <td style="text-align:right;"> -1.4253208 </td>
   <td style="text-align:right;"> 1.2047969 </td>
   <td style="text-align:right;"> -1.1830383 </td>
   <td style="text-align:right;"> 0.2367940 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical </td>
   <td style="text-align:right;"> 0.2483000 </td>
   <td style="text-align:right;"> 1.1942321 </td>
   <td style="text-align:right;"> 0.2079160 </td>
   <td style="text-align:right;"> 0.8352945 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -0.7966207 </td>
   <td style="text-align:right;"> 1.2689419 </td>
   <td style="text-align:right;"> -0.6277834 </td>
   <td style="text-align:right;"> 0.5301458 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.7685689 </td>
   <td style="text-align:right;"> 1.2787626 </td>
   <td style="text-align:right;"> 0.6010255 </td>
   <td style="text-align:right;"> 0.5478230 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.4705187 </td>
   <td style="text-align:right;"> 0.2234879 </td>
   <td style="text-align:right;"> 2.1053434 </td>
   <td style="text-align:right;"> 0.0352614 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 1.8441406 </td>
   <td style="text-align:right;"> 1.7215611 </td>
   <td style="text-align:right;"> 1.0712025 </td>
   <td style="text-align:right;"> 0.2840784 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -0.7677930 </td>
   <td style="text-align:right;"> 1.7225153 </td>
   <td style="text-align:right;"> -0.4457395 </td>
   <td style="text-align:right;"> 0.6557855 </td>
  </tr>
</tbody>
</table>

### anova 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Chisq </th>
   <th style="text-align:right;"> Df </th>
   <th style="text-align:right;"> Pr(&gt;Chisq) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2) </td>
   <td style="text-align:right;"> 287.5221645 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDE </td>
   <td style="text-align:right;"> 5.8827771 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0152897 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUS </td>
   <td style="text-align:right;"> 48.9161596 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATITUDE </td>
   <td style="text-align:right;"> 0.3740709 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.8294143 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATIN_GENUS </td>
   <td style="text-align:right;"> 0.1972849 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.9060666 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDE:LATIN_GENUS </td>
   <td style="text-align:right;"> 4.4702398 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.0344902 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2):LATITUDE:LATIN_GENUS </td>
   <td style="text-align:right;"> 1.4745763 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.4784095 </td>
  </tr>
</tbody>
</table>

### confint 
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> 2.5 % </th>
   <th style="text-align:right;"> 97.5 % </th>
   <th style="text-align:right;"> Estimate </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 2.9741294 </td>
   <td style="text-align:right;"> 3.4095241 </td>
   <td style="text-align:right;"> 3.1918267 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1 </td>
   <td style="text-align:right;"> 5.7711146 </td>
   <td style="text-align:right;"> 9.1375790 </td>
   <td style="text-align:right;"> 7.4543468 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2 </td>
   <td style="text-align:right;"> 1.3556820 </td>
   <td style="text-align:right;"> 4.6826166 </td>
   <td style="text-align:right;"> 3.0191493 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical </td>
   <td style="text-align:right;"> -0.7899409 </td>
   <td style="text-align:right;"> -0.1886743 </td>
   <td style="text-align:right;"> -0.4893076 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -1.3656823 </td>
   <td style="text-align:right;"> -0.7120212 </td>
   <td style="text-align:right;"> -1.0388517 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical </td>
   <td style="text-align:right;"> -3.7866793 </td>
   <td style="text-align:right;"> 0.9360376 </td>
   <td style="text-align:right;"> -1.4253208 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical </td>
   <td style="text-align:right;"> -2.0923519 </td>
   <td style="text-align:right;"> 2.5889518 </td>
   <td style="text-align:right;"> 0.2483000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -3.2837011 </td>
   <td style="text-align:right;"> 1.6904597 </td>
   <td style="text-align:right;"> -0.7966207 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -1.7377598 </td>
   <td style="text-align:right;"> 3.2748977 </td>
   <td style="text-align:right;"> 0.7685689 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> 0.0324905 </td>
   <td style="text-align:right;"> 0.9085469 </td>
   <td style="text-align:right;"> 0.4705187 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)1:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -1.5300572 </td>
   <td style="text-align:right;"> 5.2183383 </td>
   <td style="text-align:right;"> 1.8441406 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poly(temperature, 2)2:LATITUDEtropical:LATIN_GENUSPomacentrus </td>
   <td style="text-align:right;"> -4.1438610 </td>
   <td style="text-align:right;"> 2.6082749 </td>
   <td style="text-align:right;"> -0.7677930 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Std.Dev.(Intercept)|fish_id </td>
   <td style="text-align:right;"> 0.1872062 </td>
   <td style="text-align:right;"> 0.3928469 </td>
   <td style="text-align:right;"> 0.2711888 </td>
  </tr>
</tbody>
</table>

### r-squared
<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:right;"> R2_conditional </th>
   <th style="text-align:right;"> R2_marginal </th>
   <th style="text-align:left;"> optional </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.7772554 </td>
   <td style="text-align:right;"> 0.6828331 </td>
   <td style="text-align:left;"> FALSE </td>
  </tr>
</tbody>
</table>

## Pairwise comparisons {.tabset .tabset-faded} 

### emtrends 


```r
lc.model.1.p2.gamma.log %>% emtrends(var = "temperature", type = "response") %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=TRUE)
```
SCROLL TO THE RIGHT -->

The numbers in the left most column in the table just mention that the slopes are assuming mean **MASS_CENTERED** and **RESTING_TIME_SEONDS** values when looking at differences between latitudinal slopes.

### emmeans 

```r
lc.model.1.p2.gamma.log %>% emmeans(pairwise ~ temperature*LATITUDE*LATIN_GENUS, type = "response") %>% regrid() %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["asymp.LCL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["asymp.UCL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["z.ratio"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"(sub-tropical Apogon) - tropical Apogon","2":"30.34682","3":"7.4272848","4":"2.871479","5":"Inf","6":"-0.1276869","7":"14.982256","8":"2.5865710","9":"5.677031e-02","_rn_":"1"},{"1":"(sub-tropical Apogon) - (sub-tropical Pomacentrus)","2":"30.34682","3":"12.4213387","4":"2.653975","5":"Inf","6":"5.4386293","7":"19.404048","8":"4.6802775","9":"1.718909e-05","_rn_":"2"},{"1":"(sub-tropical Apogon) - tropical Pomacentrus","2":"30.34682","3":"12.2477886","4":"2.612309","5":"Inf","6":"5.3747030","7":"19.120874","8":"4.6884911","9":"1.651350e-05","_rn_":"3"},{"1":"tropical Apogon - (sub-tropical Pomacentrus)","2":"30.34682","3":"4.9940539","4":"1.711986","5":"Inf","6":"0.4897542","7":"9.498354","8":"2.9171121","9":"2.101099e-02","_rn_":"4"},{"1":"tropical Apogon - tropical Pomacentrus","2":"30.34682","3":"4.8205038","4":"1.646691","5":"Inf","6":"0.4879957","7":"9.153012","8":"2.9273875","9":"2.033490e-02","_rn_":"5"},{"1":"(sub-tropical Pomacentrus) - tropical Pomacentrus","2":"30.34682","3":"-0.1735501","4":"1.225141","5":"Inf","6":"-3.3969436","7":"3.049843","8":"-0.1416572","9":"9.999980e-01","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### emmeans [ratios]

```r
lc.model.1.p2.gamma.log %>% emmeans(pairwise ~ temperature*LATITUDE*LATIN_GENUS, type = "response") %>% regrid(transform="log") %>% pairs(by = "temperature") %>% summary(by = NULL, adjust = "sidak", infer=FALSE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["temperature"],"name":[2],"type":["fct"],"align":["left"]},{"label":["ratio"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(sub-tropical Apogon) / tropical Apogon","2":"30.3468208092486","3":"1.6680323","4":"0.3106712","5":"Inf","_rn_":"1"},{"1":"(sub-tropical Apogon) / (sub-tropical Pomacentrus)","2":"30.3468208092486","3":"3.0282724","4":"0.6123832","5":"Inf","_rn_":"2"},{"1":"(sub-tropical Apogon) / tropical Pomacentrus","2":"30.3468208092486","3":"2.9448195","4":"0.5441339","5":"Inf","_rn_":"3"},{"1":"tropical Apogon / (sub-tropical Pomacentrus)","2":"30.3468208092486","3":"1.8154758","4":"0.3615971","5":"Inf","_rn_":"4"},{"1":"tropical Apogon / tropical Pomacentrus","2":"30.3468208092486","3":"1.7654451","4":"0.3202806","5":"Inf","_rn_":"5"},{"1":"(sub-tropical Pomacentrus) / tropical Pomacentrus","2":"30.3468208092486","3":"0.9724421","4":"0.1922662","5":"Inf","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### temperature 

```r
lc.model.1.p2.gamma.log %>% emmeans(~ temperature*LATITUDE*LATIN_GENUS, type = "response")  %>% summary(infer=TRUE)
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["temperature"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["LATITUDE"],"name":[2],"type":["fct"],"align":["left"]},{"label":["LATIN_GENUS"],"name":[3],"type":["fct"],"align":["left"]},{"label":["response"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["asymp.LCL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["asymp.UCL"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["null"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["z.ratio"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"30.34682","2":"sub-tropical","3":"Apogon","4":"18.545437","5":"2.4868706","6":"Inf","7":"14.259170","8":"24.120142","9":"1","10":"21.77710","11":"3.825501e-105","_rn_":"1"},{"1":"30.34682","2":"tropical","3":"Apogon","4":"11.118152","5":"1.4393784","6":"Inf","7":"8.626494","8":"14.329495","9":"1","10":"18.60452","11":"2.953110e-77","_rn_":"2"},{"1":"30.34682","2":"sub-tropical","3":"Pomacentrus","4":"6.124098","5":"0.9270516","6":"Inf","7":"4.551864","8":"8.239389","9":"1","10":"11.97159","11":"5.005879e-33","_rn_":"3"},{"1":"30.34682","2":"tropical","3":"Pomacentrus","4":"6.297648","5":"0.8010043","6":"Inf","7":"4.908098","8":"8.080599","9":"1","10":"14.46782","11":"1.935198e-47","_rn_":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### temperture [combined]

```r
lc.means.temp <- lc.model.1.p2.gamma.log %>% update(LDHCS ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature, type = "response")
```

```
## NOTE: Results may be misleading due to involvement in interactions
```

```r
lc.means.temp.df <- lc.means.temp$emmeans %>% as.data.frame() %>% 
  mutate("\u394 change"=response - lag(response, n=1, default = first(response)), 
         "\u394 %change" = response/lag(response, n=1, default = first(response))*100) 
lc.means.temp.df[1,8] = 0.0000 

lc.means.temp.df  
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["temperature"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["response"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["asymp.LCL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["asymp.UCL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[" change"],"name":[7],"type":["dbl"],"align":["right"]},{"label":[" %change"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"10","2":"9.112587","3":"0.7338097","4":"Inf","5":"7.782103","6":"10.670541","7":"0.000000","8":"0.00000","_rn_":"1"},{"1":"20","2":"5.641113","3":"0.4623865","4":"Inf","5":"4.803903","6":"6.624231","7":"-3.471474","8":"61.90463","_rn_":"2"},{"1":"30","2":"8.841914","3":"0.6938526","4":"Inf","5":"7.581408","6":"10.311996","7":"3.200801","8":"156.74059","_rn_":"3"},{"1":"40","2":"19.906201","3":"1.5584462","4":"Inf","5":"17.074510","6":"23.207508","7":"11.064287","8":"225.13452","_rn_":"4"},{"1":"50","2":"30.876824","3":"2.4388666","4":"Inf","5":"26.448363","6":"36.046778","7":"10.970623","8":"155.11159","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### Genus [combined]

```r
lc.means.genus <- lc.model.1.p2.gamma.log %>% update(LDHCS ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ LATIN_GENUS, type = "response") %>% summary(infer=TRUE); lc.means.genus
```

```
## NOTE: Results may be misleading due to involvement in interactions
```

```
## $emmeans
##  LATIN_GENUS response    SE  df asymp.LCL asymp.UCL null z.ratio p.value
##  Apogon         18.25 1.396 Inf     15.71     21.20    1  37.973  <.0001
##  Pomacentrus     8.26 0.671 Inf      7.05      9.69    1  26.024  <.0001
## 
## Results are averaged over the levels of: temperature, LATITUDE 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale 
## Tests are performed on the log scale 
## 
## $contrasts
##  contrast             ratio    SE  df asymp.LCL asymp.UCL null z.ratio p.value
##  Apogon / Pomacentrus  2.21 0.246 Inf      1.77      2.75    1   7.106  <.0001
## 
## Results are averaged over the levels of: temperature, LATITUDE 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale 
## Tests are performed on the log scale
```

### Means - f(temperature)

```r
lc.means <- lc.model.1.p2.gamma.log %>% update(LDHCS ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response") 

lc.means.df <- lc.means$emmeans %>% as.data.frame() %>% 
  mutate("change"=response - lag(response, n=1, default = first(response)), 
         "%change" = response/lag(response, n=1, default = first(response))*100) %>% 
  mutate("%change" = case_when(temperature == 10 ~ 0, 
                                     TRUE ~ `%change`), 
         "change" = case_when(temperature == 10 ~ 0, 
                                     TRUE ~ `change`)) %>% 
  rename("\u394 %change" = "%change", 
         "\u394 change" = "change")

lc.means.df %>% knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE) 
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:right;"> temperature </th>
   <th style="text-align:left;"> LATIN_GENUS </th>
   <th style="text-align:left;"> LATITUDE </th>
   <th style="text-align:right;"> response </th>
   <th style="text-align:right;"> SE </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> asymp.LCL </th>
   <th style="text-align:right;"> asymp.UCL </th>
   <th style="text-align:right;">  change </th>
   <th style="text-align:right;">  %change </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 16.640930 </td>
   <td style="text-align:right;"> 2.7154268 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 12.085944 </td>
   <td style="text-align:right;"> 22.912613 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.00000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 8.392900 </td>
   <td style="text-align:right;"> 1.3630461 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 6.104822 </td>
   <td style="text-align:right;"> 11.538548 </td>
   <td style="text-align:right;"> -8.2480299 </td>
   <td style="text-align:right;"> 50.43528 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 19.089620 </td>
   <td style="text-align:right;"> 2.9776722 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 14.061239 </td>
   <td style="text-align:right;"> 25.916178 </td>
   <td style="text-align:right;"> 10.6967190 </td>
   <td style="text-align:right;"> 227.44961 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 40.354658 </td>
   <td style="text-align:right;"> 6.2465610 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 29.794414 </td>
   <td style="text-align:right;"> 54.657844 </td>
   <td style="text-align:right;"> 21.2650387 </td>
   <td style="text-align:right;"> 211.39582 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 59.597329 </td>
   <td style="text-align:right;"> 9.2375287 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 43.983661 </td>
   <td style="text-align:right;"> 80.753661 </td>
   <td style="text-align:right;"> 19.2426711 </td>
   <td style="text-align:right;"> 147.68389 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 6.340568 </td>
   <td style="text-align:right;"> 1.1180577 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 4.487788 </td>
   <td style="text-align:right;"> 8.958265 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.00000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 4.362387 </td>
   <td style="text-align:right;"> 0.7684587 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 3.088732 </td>
   <td style="text-align:right;"> 6.161239 </td>
   <td style="text-align:right;"> -1.9781809 </td>
   <td style="text-align:right;"> 68.80120 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 5.303728 </td>
   <td style="text-align:right;"> 0.9326075 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 3.757560 </td>
   <td style="text-align:right;"> 7.486115 </td>
   <td style="text-align:right;"> 0.9413412 </td>
   <td style="text-align:right;"> 121.57858 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 13.267229 </td>
   <td style="text-align:right;"> 2.3289670 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 9.404980 </td>
   <td style="text-align:right;"> 18.715548 </td>
   <td style="text-align:right;"> 7.9635006 </td>
   <td style="text-align:right;"> 250.14911 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> sub-tropical </td>
   <td style="text-align:right;"> 21.519073 </td>
   <td style="text-align:right;"> 3.7785385 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 15.253198 </td>
   <td style="text-align:right;"> 30.358913 </td>
   <td style="text-align:right;"> 8.2518445 </td>
   <td style="text-align:right;"> 162.19720 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 11.151737 </td>
   <td style="text-align:right;"> 1.7230513 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 8.238035 </td>
   <td style="text-align:right;"> 15.095982 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.00000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 7.883144 </td>
   <td style="text-align:right;"> 1.2760497 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 5.740040 </td>
   <td style="text-align:right;"> 10.826399 </td>
   <td style="text-align:right;"> -3.2685922 </td>
   <td style="text-align:right;"> 70.68984 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 9.790307 </td>
   <td style="text-align:right;"> 1.4411508 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 7.336651 </td>
   <td style="text-align:right;"> 13.064557 </td>
   <td style="text-align:right;"> 1.9071623 </td>
   <td style="text-align:right;"> 124.19291 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 22.062176 </td>
   <td style="text-align:right;"> 3.2455107 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 16.535992 </td>
   <td style="text-align:right;"> 29.435163 </td>
   <td style="text-align:right;"> 12.2718698 </td>
   <td style="text-align:right;"> 225.34715 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Apogon </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 33.652721 </td>
   <td style="text-align:right;"> 5.1494886 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 24.932774 </td>
   <td style="text-align:right;"> 45.422367 </td>
   <td style="text-align:right;"> 11.5905443 </td>
   <td style="text-align:right;"> 152.53582 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 5.860283 </td>
   <td style="text-align:right;"> 0.8677358 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 4.384101 </td>
   <td style="text-align:right;"> 7.833512 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.00000 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 3.508517 </td>
   <td style="text-align:right;"> 0.5381843 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 2.597495 </td>
   <td style="text-align:right;"> 4.739063 </td>
   <td style="text-align:right;"> -2.3517655 </td>
   <td style="text-align:right;"> 59.86942 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 6.166098 </td>
   <td style="text-align:right;"> 0.9068998 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 4.621862 </td>
   <td style="text-align:right;"> 8.226285 </td>
   <td style="text-align:right;"> 2.6575804 </td>
   <td style="text-align:right;"> 175.74654 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 13.293254 </td>
   <td style="text-align:right;"> 1.9557665 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 9.963192 </td>
   <td style="text-align:right;"> 17.736345 </td>
   <td style="text-align:right;"> 7.1271568 </td>
   <td style="text-align:right;"> 215.58618 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:left;"> Pomacentrus </td>
   <td style="text-align:left;"> tropical </td>
   <td style="text-align:right;"> 21.060077 </td>
   <td style="text-align:right;"> 3.0940306 </td>
   <td style="text-align:right;"> Inf </td>
   <td style="text-align:right;"> 15.790872 </td>
   <td style="text-align:right;"> 28.087546 </td>
   <td style="text-align:right;"> 7.7668230 </td>
   <td style="text-align:right;"> 158.42680 </td>
  </tr>
</tbody>
</table>

### Abs. diff - f(temperature)

```r
lc.model.1.p2.gamma.log %>% update(LDHCS ~ factor(temperature) * LATITUDE * LATIN_GENUS + (1|fish_id)) %>% emmeans(pairwise ~ temperature*LATIN_GENUS*LATITUDE, type = "response") %>% regrid() %>% pairs(by =c("LATIN_GENUS","LATITUDE")) %>% summary(infer=TRUE, type = "response")
```

<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrast"],"name":[1],"type":["fct"],"align":["left"]},{"label":["LATIN_GENUS"],"name":[2],"type":["fct"],"align":["left"]},{"label":["LATITUDE"],"name":[3],"type":["fct"],"align":["left"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["asymp.LCL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["asymp.UCL"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["z.ratio"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"temperature10 - temperature20","2":"Apogon","3":"sub-tropical","4":"8.2480299","5":"2.5739642","6":"Inf","7":"1.22683615","8":"15.2692236","9":"3.2044073","10":"1.182112e-02","_rn_":"1"},{"1":"temperature10 - temperature30","2":"Apogon","3":"sub-tropical","4":"-2.4486892","5":"3.2509897","6":"Inf","7":"-11.31665556","8":"6.4192772","9":"-0.7532135","10":"9.437311e-01","_rn_":"2"},{"1":"temperature10 - temperature40","2":"Apogon","3":"sub-tropical","4":"-23.7137278","5":"5.8557367","6":"Inf","7":"-39.68685636","8":"-7.7405993","9":"-4.0496575","10":"4.921655e-04","_rn_":"3"},{"1":"temperature10 - temperature50","2":"Apogon","3":"sub-tropical","4":"-42.9563989","5":"8.6400010","6":"Inf","7":"-66.52437230","8":"-19.3884256","9":"-4.9718049","10":"6.574392e-06","_rn_":"4"},{"1":"temperature20 - temperature30","2":"Apogon","3":"sub-tropical","4":"-10.6967190","5":"2.8130855","6":"Inf","7":"-18.37018160","8":"-3.0232565","9":"-3.8024863","10":"1.349528e-03","_rn_":"5"},{"1":"temperature20 - temperature40","2":"Apogon","3":"sub-tropical","4":"-31.9617577","5":"5.8945220","6":"Inf","7":"-48.04068393","8":"-15.8828314","9":"-5.4222815","10":"5.861853e-07","_rn_":"6"},{"1":"temperature20 - temperature50","2":"Apogon","3":"sub-tropical","4":"-51.2044288","5":"8.8355049","6":"Inf","7":"-75.30569280","8":"-27.1031648","9":"-5.7953031","10":"6.807480e-08","_rn_":"7"},{"1":"temperature30 - temperature40","2":"Apogon","3":"sub-tropical","4":"-21.2650387","5":"5.8394702","6":"Inf","7":"-37.19379576","8":"-5.3362816","9":"-3.6416041","10":"2.513423e-03","_rn_":"8"},{"1":"temperature30 - temperature50","2":"Apogon","3":"sub-tropical","4":"-40.5077098","5":"8.5934625","6":"Inf","7":"-63.94873661","8":"-17.0666829","9":"-4.7137821","10":"2.397666e-05","_rn_":"9"},{"1":"temperature40 - temperature50","2":"Apogon","3":"sub-tropical","4":"-19.2426711","5":"8.9764529","6":"Inf","7":"-43.72840938","8":"5.2430672","9":"-2.1436832","10":"2.016335e-01","_rn_":"10"},{"1":"temperature10 - temperature20","2":"Pomacentrus","3":"sub-tropical","4":"1.9781809","5":"1.0947207","6":"Inf","7":"-1.00797016","8":"4.9643319","9":"1.8070188","10":"3.693861e-01","_rn_":"11"},{"1":"temperature10 - temperature30","2":"Pomacentrus","3":"sub-tropical","4":"1.0368396","5":"1.1611996","6":"Inf","7":"-2.13065086","8":"4.2043301","9":"0.8929039","10":"8.996441e-01","_rn_":"12"},{"1":"temperature10 - temperature40","2":"Pomacentrus","3":"sub-tropical","4":"-6.9266609","5":"2.1727016","6":"Inf","7":"-12.85330060","8":"-1.0000213","9":"-3.1880407","10":"1.247511e-02","_rn_":"13"},{"1":"temperature10 - temperature50","2":"Pomacentrus","3":"sub-tropical","4":"-15.1785054","5":"3.5174032","6":"Inf","7":"-24.77318772","8":"-5.5838231","9":"-4.3152589","10":"1.551258e-04","_rn_":"14"},{"1":"temperature20 - temperature30","2":"Pomacentrus","3":"sub-tropical","4":"-0.9413412","5":"0.9635338","6":"Inf","7":"-3.56964412","8":"1.6869617","9":"-0.9769675","10":"8.657135e-01","_rn_":"15"},{"1":"temperature20 - temperature40","2":"Pomacentrus","3":"sub-tropical","4":"-8.9048418","5":"2.1621157","6":"Inf","7":"-14.80260560","8":"-3.0070780","9":"-4.1185778","10":"3.673068e-04","_rn_":"16"},{"1":"temperature20 - temperature50","2":"Pomacentrus","3":"sub-tropical","4":"-17.1566863","5":"3.5618439","6":"Inf","7":"-26.87259287","8":"-7.4407797","9":"-4.8167990","10":"1.441758e-05","_rn_":"17"},{"1":"temperature30 - temperature40","2":"Pomacentrus","3":"sub-tropical","4":"-7.9635006","5":"2.1590124","6":"Inf","7":"-13.85279920","8":"-2.0742019","9":"-3.6884923","10":"2.102759e-03","_rn_":"18"},{"1":"temperature30 - temperature50","2":"Pomacentrus","3":"sub-tropical","4":"-16.2153451","5":"3.5367900","6":"Inf","7":"-25.86291024","8":"-6.5677799","9":"-4.5847633","10":"4.466093e-05","_rn_":"19"},{"1":"temperature40 - temperature50","2":"Pomacentrus","3":"sub-tropical","4":"-8.2518445","5":"3.6112033","6":"Inf","7":"-18.10239223","8":"1.5987032","9":"-2.2850679","10":"1.496311e-01","_rn_":"20"},{"1":"temperature10 - temperature20","2":"Apogon","3":"tropical","4":"3.2685922","5":"1.7473931","6":"Inf","7":"-1.49790204","8":"8.0350864","9":"1.8705534","10":"3.333070e-01","_rn_":"21"},{"1":"temperature10 - temperature30","2":"Apogon","3":"tropical","4":"1.3614299","5":"1.8141156","6":"Inf","7":"-3.58706821","8":"6.3099280","9":"0.7504648","10":"9.444454e-01","_rn_":"22"},{"1":"temperature10 - temperature40","2":"Apogon","3":"tropical","4":"-10.9104399","5":"3.0941345","6":"Inf","7":"-19.35054087","8":"-2.4703390","9":"-3.5261686","10":"3.860353e-03","_rn_":"23"},{"1":"temperature10 - temperature50","2":"Apogon","3":"tropical","4":"-22.5009842","5":"4.8491766","6":"Inf","7":"-35.72844392","8":"-9.2735245","9":"-4.6401660","10":"3.426220e-05","_rn_":"24"},{"1":"temperature20 - temperature30","2":"Apogon","3":"tropical","4":"-1.9071623","5":"1.5733634","6":"Inf","7":"-6.19894269","8":"2.3846181","9":"-1.2121562","10":"7.443429e-01","_rn_":"25"},{"1":"temperature20 - temperature40","2":"Apogon","3":"tropical","4":"-14.1790321","5":"3.0474399","6":"Inf","7":"-22.49176073","8":"-5.8663035","9":"-4.6527684","10":"3.224361e-05","_rn_":"26"},{"1":"temperature20 - temperature50","2":"Apogon","3":"tropical","4":"-25.7695764","5":"4.9145814","6":"Inf","7":"-39.17544561","8":"-12.3637072","9":"-5.2434937","10":"1.567170e-06","_rn_":"27"},{"1":"temperature30 - temperature40","2":"Apogon","3":"tropical","4":"-12.2718698","5":"3.0146285","6":"Inf","7":"-20.49509629","8":"-4.0486434","9":"-4.0707735","10":"4.501968e-04","_rn_":"28"},{"1":"temperature30 - temperature50","2":"Apogon","3":"tropical","4":"-23.8624141","5":"4.8163876","6":"Inf","7":"-37.00043292","8":"-10.7243953","9":"-4.9544214","10":"7.188175e-06","_rn_":"29"},{"1":"temperature40 - temperature50","2":"Apogon","3":"tropical","4":"-11.5905443","5":"5.0114443","6":"Inf","7":"-25.26063372","8":"2.0795452","9":"-2.3128151","10":"1.407009e-01","_rn_":"30"},{"1":"temperature10 - temperature20","2":"Pomacentrus","3":"tropical","4":"2.3517655","5":"0.8370525","6":"Inf","7":"0.06847508","8":"4.6350559","9":"2.8095794","10":"3.978000e-02","_rn_":"31"},{"1":"temperature10 - temperature30","2":"Pomacentrus","3":"tropical","4":"-0.3058149","5":"0.9957873","6":"Inf","7":"-3.02209792","8":"2.4104681","9":"-0.3071087","10":"9.980711e-01","_rn_":"32"},{"1":"temperature10 - temperature40","2":"Pomacentrus","3":"tropical","4":"-7.4329718","5":"1.8268330","6":"Inf","7":"-12.41615989","8":"-2.4497836","9":"-4.0687747","10":"4.540201e-04","_rn_":"33"},{"1":"temperature10 - temperature50","2":"Pomacentrus","3":"tropical","4":"-15.1997948","5":"2.8910928","6":"Inf","7":"-23.08604363","8":"-7.3135459","9":"-5.2574565","10":"1.452964e-06","_rn_":"34"},{"1":"temperature20 - temperature30","2":"Pomacentrus","3":"tropical","4":"-2.6575804","5":"0.8717144","6":"Inf","7":"-5.03542051","8":"-0.2797403","9":"-3.0486826","10":"1.949063e-02","_rn_":"35"},{"1":"temperature20 - temperature40","2":"Pomacentrus","3":"tropical","4":"-9.7847372","5":"1.8349458","6":"Inf","7":"-14.79005546","8":"-4.7794190","9":"-5.3324393","10":"9.646223e-07","_rn_":"36"},{"1":"temperature20 - temperature50","2":"Pomacentrus","3":"tropical","4":"-17.5515602","5":"2.9461574","6":"Inf","7":"-25.58801303","8":"-9.5151074","9":"-5.9574414","10":"2.558884e-08","_rn_":"37"},{"1":"temperature30 - temperature40","2":"Pomacentrus","3":"tropical","4":"-7.1271568","5":"1.8202247","6":"Inf","7":"-12.09231908","8":"-2.1619946","9":"-3.9155369","10":"8.575680e-04","_rn_":"38"},{"1":"temperature30 - temperature50","2":"Pomacentrus","3":"tropical","4":"-14.8939798","5":"2.8767327","6":"Inf","7":"-22.74105768","8":"-7.0469020","9":"-5.1773944","10":"2.236365e-06","_rn_":"39"},{"1":"temperature40 - temperature50","2":"Pomacentrus","3":"tropical","4":"-7.7668230","5":"2.9665087","6":"Inf","7":"-15.85878943","8":"0.3251434","9":"-2.6181696","10":"6.707531e-02","_rn_":"40"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>

### effect size

```r
lc.emm <- lc.model.1.p2.gamma.log %>% emmeans(~temperature*LATITUDE*LATIN_GENUS)
eff_size(lc.emm, sigma = sigma(lc.model.1.p2.gamma.log), edf=df.residual(lc.model.1.p2.gamma.log))
```

```
##  contrast                                                                                                  
##  (temperature30.3468208092486 sub-tropical Apogon) - temperature30.3468208092486 tropical Apogon           
##  (temperature30.3468208092486 sub-tropical Apogon) - (temperature30.3468208092486 sub-tropical Pomacentrus)
##  (temperature30.3468208092486 sub-tropical Apogon) - temperature30.3468208092486 tropical Pomacentrus      
##  temperature30.3468208092486 tropical Apogon - (temperature30.3468208092486 sub-tropical Pomacentrus)      
##  temperature30.3468208092486 tropical Apogon - temperature30.3468208092486 tropical Pomacentrus            
##  (temperature30.3468208092486 sub-tropical Pomacentrus) - temperature30.3468208092486 tropical Pomacentrus 
##  effect.size    SE  df asymp.LCL asymp.UCL
##       1.2284 0.452 Inf     0.342     2.114
##       2.6601 0.506 Inf     1.668     3.653
##       2.5930 0.465 Inf     1.681     3.505
##       1.4317 0.484 Inf     0.482     2.381
##       1.3646 0.442 Inf     0.499     2.230
##      -0.0671 0.475 Inf    -0.997     0.863
## 
## sigma used for effect sizes: 0.4165 
## Confidence level used: 0.95
```

### {-}

## Summary figure


```r
lc.emm <- emmeans(lc.model.1.p2.gamma.log, ~temperature|LATITUDE|LATIN_GENUS, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") 

lc.emm.df <- lc.emm %>% as.data.frame() %>%
  unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 

lc.obs <-  lc.data %>% 
  mutate(Pred=exp(predict(lc.model.1.p2.gamma.log, re.form=NA)),
         Resid = residuals(lc.model.1.p2.gamma.log, type="response"),
         Fit = Pred + Resid) %>%
   unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 


lc.plot <- ggplot(lc.emm.df, aes(y=response, x=temperature, linetype=species, color = species, fill=species))+
  geom_jitter(data=lc.obs, 
              aes(y=Fit, color = species), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= asymp.LCL, ymax= asymp.UCL),
              alpha = 0.2, 
              color=NA)+ 
  #scale_x_continuous(limits = c(9, 52), 
                     #breaks = seq(10, 52, by = 10))+ 
  #scale_y_continuous(limits = c(0,120), breaks = seq(0, 120, by = 20)) +
  theme_classic() + 
  ylab("LDH:CS") + 
  xlab("")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Apogon doederlein","Apogon rubrimacula","Pomacentrus australis", "Pomacentrus moluccensis")) +  
  theme(legend.position = "top", 
        legend.text = element_text(size = 10), 
        legend.title = element_blank(), 
        axis.title = element_text(size =12), 
        axis.text = element_text(size=10)); lc.plot
```

![](01.DataAnalysis_files/figure-html/lc-sum-fig-1.png)<!-- -->



# Descriptive statistics 


```r
lc.data2 <- CS.data |> 
  full_join(select(ldh.data, c("UNIQUE_SAMPLE_ID","LDH_ACTIVITY")), by = "UNIQUE_SAMPLE_ID") |> 
  mutate(LDHCS = LDH_ACTIVITY/CS_ACTIVITY) %>% 
  separate(UNIQUE_SAMPLE_ID, into=c("LATIN_NAME_ABBREV","rep","temp"), sep="_", remove=FALSE) |>
  mutate(LATIN_NAME= case_when(LATIN_NAME_ABBREV =="Adoed"~ "Apogon doederlein", 
                               LATIN_NAME_ABBREV =="Arub"~ "Apogon rubrimacula",
                               LATIN_NAME_ABBREV =="Pmol"~ "Pomacentrus moluccensis",
                               LATIN_NAME_ABBREV =="Paus"~ "Pomacentrus australis",
                               TRUE ~ LATIN_NAME
                   )) %>% select(c("LATIN_NAME", "temp", "CS_ACTIVITY", "LDH_ACTIVITY", "LDHCS")) %>% 
  pivot_longer(!c(LATIN_NAME,temp), names_to = "enzyme") %>% 
  drop_na(value)
  
 
lc.data.table <- table(lc.data2$LATIN_NAME,lc.data2$temp, lc.data2$enzyme) %>% as.data.frame() 
table(lc.data2$LATIN_NAME,lc.data2$temp, lc.data2$enzyme)%>% 
  knitr::kable(format = "html")  %>%
  kable_paper(full_width = TRUE)
```

<table class=" lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Var1 </th>
   <th style="text-align:left;"> Var2 </th>
   <th style="text-align:left;"> Var3 </th>
   <th style="text-align:right;"> Freq </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> CS_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDH_ACTIVITY </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 10 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 20 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 30 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 40 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon doederlein </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apogon rubrimacula </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus australis </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pomacentrus moluccensis </td>
   <td style="text-align:left;"> 50 </td>
   <td style="text-align:left;"> LDHCS </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
</tbody>
</table>

# Figure {.tabset .tabset-faded}  

## Figure 1


```r
cs.genus.emm <- emmeans(cs.model.1.p2.log, ~temperature|LATIN_GENUS, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") %>% as.data.frame()

cs.genus.obs <-  CS.data %>% 
  mutate(Pred=exp(predict(cs.model.1.p2.log, re.form=NA)),
         Resid = residuals(cs.model.1.p2.log, type="response"),
         Fit = Pred + Resid)  


cs.genus.plot <- ggplot(cs.genus.emm, aes(y=response, x=temperature, linetype=LATIN_GENUS, color = LATIN_GENUS, fill=LATIN_GENUS))+
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= lower.CL, ymax= upper.CL),
              alpha = 0.4, 
              color=NA)+ 
  geom_jitter(data=cs.genus.obs , 
              aes(y=Fit, color = LATIN_GENUS), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  #scale_x_continuous(limits = c(9, 52), 
                     #breaks = seq(10, 52, by = 10))+ 
  #scale_y_continuous(limits = c(0,120), breaks = seq(0, 120, by = 20)) +
  theme_classic() + 
  ylab(expression("CS ACTIVITY (U mg "^{-1} * " tissue)")) + 
  xlab("Temperature (C)") + 
  scale_linetype_manual(values = c("solid", "dashed"), 
                        labels = c("Ostorhinchus","Pomacentrus")) +
  scale_color_manual(values=c("black","gray60"), 
                        labels = c("Ostorhinchus","Pomacentrus")) +
  scale_fill_manual(values=c("black","gray60"), 
                        labels = c("Ostorhinchus","Pomacentrus")) + 
   theme(legend.position = c(0.2,0.85), 
        legend.text = element_text(size = 14, face = "italic"), 
        legend.title = element_blank(), 
        axis.title = element_text(size =16), 
        axis.text = element_text(size=14))



ggsave(file="./02.Figures/Figure1/Figure1_cs_genus_plot.svg",  plot=cs.genus.plot, width=15.5, height=8.5, units = "in", dpi=300) 
ggsave(file="./02.Figures/Figure1/Figure1_cs_genus_plot2.svg", plot=cs.genus.plot, width=12, height=7, units = "in", dpi=300)
ggsave(file="./02.Figures/Figure1/Figure1_cs_genus_plot3.svg", plot=cs.genus.plot, width=8, height=5, units = "in", dpi=300)
ggsave(file="./02.Figures/Figure1/Figure1_cs_genus_plot.pdf",  plot=cs.genus.plot, width=15.5, height=8.5, units = "in", dpi=300)
ggsave(file="./02.Figures/Figure1/Figure1_cs_genus_plot2.pdf", plot=cs.genus.plot, width=12, height=7, units = "in", dpi=300)
ggsave(file="./02.Figures/Figure1/Figure1_cs_genus_plot3.pdf", plot=cs.genus.plot, width=8, height=5, units = "in", dpi=300)
```
## Figure 2

```r
#--- LDH plot ---# 
ldh.emm <- emmeans(ldh.sqrt.model.1.p2, ~temperature|LATITUDE|LATIN_GENUS, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") 

ldh.emm.df <- ldh.emm %>% as.data.frame() %>%
  unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 

ldh.obs <-  ldh.data %>% 
  mutate(Pred=predict(ldh.sqrt.model.1.p2, re.form=NA, type="response"),
         Resid = residuals(ldh.sqrt.model.1.p2),
         Fit = Pred + Resid) %>%
   unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 


ldh.plot <- ggplot(ldh.emm.df, aes(y=response, x=temperature, linetype=species, color = species, fill=species))+
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= lower.CL, ymax= upper.CL),
              alpha = 0.2, 
              color=NA)+ 
  geom_jitter(data=ldh.obs, 
              aes(y=Fit^2, color = species), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,350), breaks = seq(0, 350, by = 50)) +
  theme_classic() + 
  ylab(expression("LDH ACTIVITY (U mg "^{-1} * "tissue)")) + 
  xlab("")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Ostorhinchus doederlein \n (sub-tropical)","Ostorhinchus rubrimacula \n (tropical)","Pomacentrus australis \n (sub-tropical)", "Pomacentrus moluccensis \n (tropical)"))+
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Ostorhinchus doederlein \n (sub-tropical)","Ostorhinchus rubrimacula \n (tropical)","Pomacentrus australis \n (sub-tropical)", "Pomacentrus moluccensis \n (tropical)")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Ostorhinchus doederlein \n (sub-tropical)","Ostorhinchus rubrimacula \n (tropical)","Pomacentrus australis \n (sub-tropical)", "Pomacentrus moluccensis \n (tropical)")) + 
  theme(legend.position = "none", 
        legend.text = element_text(size = 12, face = "italic"), 
        legend.title = element_blank(), 
        axis.title = element_text(size =14), 
        axis.text = element_text(size=12), 
        axis.text.x = element_blank())

#--- citrate synthase plot ---#
cs.emm <- emmeans(cs.model.1.p2.log, ~temperature|LATITUDE|LATIN_GENUS, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") 

cs.emm.df <- cs.emm %>% as.data.frame() %>%
  unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 

cs.obs <-  CS.data %>% 
  mutate(Pred=exp(predict(cs.model.1.p2.log, re.form=NA)),
         Resid = residuals(cs.model.1.p2.log,  type="response"),
         Fit = Pred + Resid) %>%
   unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 


cs.plot <- ggplot(cs.emm.df, aes(y=response, x=temperature, linetype=species, color = species, fill=species))+
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= lower.CL, ymax= upper.CL),
              alpha = 0.2, 
              color=NA)+ 
  geom_jitter(data=cs.obs, 
              aes(y=Fit, color = species), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,16), breaks = seq(0, 16, by = 2)) +
  theme_classic() + 
  ylab(expression("CS ACTIVITY (U mg "^{-1} * "tissue)")) + 
  xlab("")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Ostorhinchus doederlein (sub-tropical)","Ostorhinchus rubrimacula (tropical)","Pomacentrus australis(sub-tropical)", "Pomacentrus moluccensis (tropical)"))+
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Ostorhinchus doederlein (sub-tropical)","Ostorhinchus rubrimacula (tropical)","Pomacentrus australis(sub-tropical)", "Pomacentrus moluccensis (tropical)")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Ostorhinchus doederlein (sub-tropical)","Ostorhinchus rubrimacula (tropical)","Pomacentrus australis(sub-tropical)", "Pomacentrus moluccensis (tropical)")) +  
  theme(legend.position = c(0.3,0.8), 
        legend.text = element_text(size = 12, face = "italic"), 
        legend.title = element_blank(), 
        axis.title = element_text(size =14), 
        axis.text = element_text(size=12), 
        axis.text.x = element_blank()) 

#--- LDH:CS plot ---# 
lc.emm <- emmeans(lc.model.1.p2.gamma.log, ~temperature|LATITUDE|LATIN_GENUS, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") 

lc.emm.df <- lc.emm %>% as.data.frame() %>%
  unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 

lc.obs <-  lc.data %>% 
  mutate(Pred=exp(predict(lc.model.1.p2.gamma.log, re.form=NA)),
         Resid = residuals(lc.model.1.p2.gamma.log, type="response"),
         Fit = Pred + Resid) %>%
   unite("species", c("LATIN_GENUS","LATITUDE"), sep = "-", remove = FALSE) 


lc.plot <- ggplot(lc.emm.df, aes(y=response, x=temperature, linetype=species, color = species, fill=species))+
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= asymp.LCL, ymax= asymp.UCL),
              alpha = 0.2, 
              color=NA)+ 
  geom_jitter(data=lc.obs, 
              aes(y=Fit, color = species), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,120), breaks = seq(0, 120, by = 20)) +
  theme_classic() + 
  ylab("LDH:CS ratio") + 
  xlab("Temperature (C)")+
  scale_linetype_manual(values = c("solid", "dashed","solid", "dashed"), 
                        labels = c("Ostorhinchus doederlein \n (sub-tropical)","Ostorhinchus rubrimacula \n (tropical)","Pomacentrus australis \n (sub-tropical)", "Pomacentrus moluccensis \n (tropical)")) +
  scale_color_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Ostorhinchus doederlein \n (sub-tropical)","Ostorhinchus rubrimacula \n (tropical)","Pomacentrus australis \n (sub-tropical)", "Pomacentrus moluccensis \n (tropical)")) +
  scale_fill_manual(values=c("#3F3525","#C65C1B",  "#07AFF2", "#EAAE00"), 
                        labels = c("Ostorhinchus doederlein \n (sub-tropical)","Ostorhinchus rubrimacula \n (tropical)","Pomacentrus australis \n (sub-tropical)", "Pomacentrus moluccensis \n (tropical)")) +  
  theme(legend.position = "none", 
        legend.text = element_text(size = 12, face = "italic"), 
        legend.title = element_blank(), 
        axis.title = element_text(size =14), 
        axis.text = element_text(size=12)) + 
  guides(color = guide_legend(nrow=2))

species.plot <- ggarrange(cs.plot, ldh.plot, lc.plot, 
         nrow = 3, 
         ncol= 1, 
         align = "hv", 
         labels = c("A","B","C"), 
         common.legend = FALSE); species.plot

ggsave(file="./02.Figures/Figure2/Figure2_species_plot.svg",  plot=species.plot, width=8.5, height=15.5, units = "in", dpi=300) 
ggsave(file="./02.Figures/Figure2/Figure2_species_plot2.svg", plot=species.plot, width=7, height=12, units = "in", dpi=300)
#ggsave(file="./02.Figures/Figure2/Figure2_species_plot3.svg", plot=species.plot, width=8, height=5, units = "in", dpi=300)
ggsave(file="./02.Figures/Figure2/Figure2_species_plot.pdf",  plot=species.plot, width=8.5, height=15.5, units = "in", dpi=300)
ggsave(file="./02.Figures/Figure2/Figure2_species_plot2.pdf", plot=species.plot, width=7, height=12, units = "in", dpi=300)
#ggsave(file="./02.Figures/Figure2/Figure2_species_plot3.pdf", plot=species.plot, width=5, height=8, units = "in", dpi=300)
```

## Supplemental Figure 1


```r
#--- LDH plot ---#
ldh.temp.emm <- emmeans(ldh.sqrt.model.1.p2, ~temperature, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") %>% as.data.frame()

ldh.temp.obs <- ldh.data %>% 
  mutate(Pred=predict(ldh.sqrt.model.1.p2, re.form=NA, type="response"),
         Resid = residuals(ldh.sqrt.model.1.p2),
         Fit = Pred + Resid)  


ldh.temp.plot <- ggplot(ldh.temp.emm, aes(y=response, x=temperature))+
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= lower.CL, ymax= upper.CL),
              alpha = 0.4, 
              color=NA)+ 
  geom_jitter(data=ldh.temp.obs , 
              aes(y=Fit^2, fill = "black"), 
              width=0.05, 
              alpha = 0.3, 
              size = 2)+ 
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,350), breaks = seq(0, 350, by = 50)) +
  theme_classic() + 
  ylab(expression("LDH ACTIVITY (U mg "^{-1} * "tissue)")) + 
  xlab("TEMPERATURE (C)")+
  theme(legend.position = "none",
        axis.title = element_text(size =12), 
        axis.text = element_text(size=10)); ldh.temp.plot  

#--- CS plot ---#
cs.temp.emm <- emmeans(cs.model.1.p2.log, ~temperature, 
                   at = list(temperature = seq(from =10, to =50, by =.1)), 
                   type = "response") 

cs.temp.df <- cs.temp.emm %>% as.data.frame() 

cs.temp.obs <-  CS.data %>% 
  mutate(Pred=exp(predict(cs.model.1.p2.log, re.form=NA)),
         Resid = residuals(cs.model.1.p2.log,  type="response"),
         Fit = Pred + Resid) 


cs.temp.plot <- ggplot(cs.temp.df, aes(y=response, x=temperature))+
  geom_jitter(data=cs.temp.obs, 
              aes(y=Fit, fill="black"), 
              width=0.05, 
              alpha = 0.3, 
              size = 2) +
  geom_line(linewidth =1) + 
  geom_ribbon(aes(x=temperature, 
              ymin= lower.CL, ymax= upper.CL),
              alpha = 0.2, 
              color=NA)+ 
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,12), breaks = seq(0, 12, by = 2)) +
  theme_classic() + 
  ylab(expression("CS ACTIVITY (U mg "^{-1} * "tissue)")) + 
  xlab(" ")+
  theme(legend.position = "none", 
        axis.title = element_text(size =12), 
        axis.text = element_text(size=10)); cs.temp.plot

temp.plot <- ggarrange(cs.temp.plot, ldh.temp.plot,
         nrow = 2, 
         ncol= 1, 
          align = "hv", 
         labels = c("A","B"), 
         common.legend = FALSE); temp.plot 


ggsave(file="./02.Figures/SFigure1/SFigure1_temp_plot.svg",  plot=temp.plot, width=15.5, height=8.5, units = "in", dpi=300) 
ggsave(file="./02.Figures/SFigure1/SFigure1_temp_plot2.svg", plot=temp.plot, width=12, height=7, units = "in", dpi=300)
#ggsave(file="./02.Figures/SFigure1/SFigure1_temp_plot3.svg", plot=temp.plot, width=8, height=5, units = "in", dpi=300)
ggsave(file="./02.Figures/SFigure1/SFigure1_temp_plot.pdf",  plot=temp.plot, width=15.5, height=8.5, units = "in", dpi=300)
ggsave(file="./02.Figures/SFigure1/SFigure1_temp_plot2.pdf", plot=temp.plot, width=12, height=7, units = "in", dpi=300)
#ggsave(file="./02.Figures/SFigure1/SFigure1_temp_plot3.pdf", plot=cs.genus.plot, width=8, height=5, units = "in", dpi=300)
```

## Supplemental Figure 2


```r
ldh.dperc.plot <- ggplot(ldh.means.temp.df, aes(x=temperature, y=` %change`)) + 
  geom_line(size=2) + 
  geom_point(shape = 15, color="red", size = 3) +
  xlab("") + ylab(expression("\u394 % CHANGE IN LDH ACTIVITY (U mg "^{-1} * "tissue)"))+
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,400), breaks = seq(0, 400, by = 50)) +
  theme_classic() + 
  theme(axis.title = element_text(size =13), 
        axis.text = element_text(size=12))

cs.dperc.plot <- ggplot(cs.means.temp.df, aes(x=temperature, y=` %change`)) + 
  geom_line(size=2) + 
  geom_point(shape = 15, color="red", size = 3) +
  xlab("") + ylab(expression("\u394 % CHANGE IN CS ACTIVITY (U mg "^{-1} * "tissue)"))+
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  scale_y_continuous(limits = c(0,250), breaks = seq(0, 250, by = 50)) +
  theme_classic()  + 
  theme(axis.title = element_text(size =13), 
        axis.text = element_text(size=12))  

lc.dperc.plot <- ggplot(lc.means.temp.df, aes(x=temperature, y=` %change`)) + 
  geom_line(size=2) + 
  geom_point(shape = 15, color="red", size = 3) +
  xlab("TEMPERATURE") + ylab(expression("\u394 % CHANGE IN LDH:CS RATIO"))+
  scale_x_continuous(limits = c(9, 52), 
                     breaks = seq(10, 52, by = 10))+ 
  #scale_y_continuous(limits = c(0,250), breaks = seq(0, 250, by = 50)) +
  theme_classic()  + 
  theme(axis.title = element_text(size =13), 
        axis.text = element_text(size=12))

dchange.plot <- ggarrange(cs.dperc.plot, ldh.dperc.plot, lc.dperc.plot,
         nrow = 3, 
         ncol= 1, 
          align = "hv", 
         labels = c("A","B","C"), 
         common.legend = FALSE); dchange.plot 

ggsave(file="./02.Figures/SFigure2/SFigure2_dchange_plot.svg",  plot=dchange.plot, width=8.5, height=15.5, units = "in", dpi=300) 
#ggsave(file="./02.Figures/SFigure2/SFigure2_dchange_plot2.svg", plot=dchange.plot, width=7, height=12, units = "in", dpi=300)
#ggsave(file="./02.Figures/SFigure2/SFigure2_dchange_plot3.svg", plot=dchange.plot, width=5, height=8, units = "in", dpi=300)
ggsave(file="./02.Figures/SFigure2/SFigure2_dchange_plot.pdf",  plot=dchange.plot, width=8.5, height=15.5, units = "in", dpi=300)
#ggsave(file="./02.Figures/SFigure2/SFigure2_dchange_plot2.pdf", plot=dchange.plot, width=7, height=12, units = "in", dpi=300)
#ggsave(file="./02.Figures/SFigure2/SFigure2_dchange_plot3.pdf", plot=dchange.plot, width=5, height=8, units = "in", dpi=300)
```
## {-}
